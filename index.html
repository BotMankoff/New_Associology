<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Associology</title>
<style>
  :root {
    --size: min(90vw, 420px);
    --dark: #1a1a2e;
    --light: #F5F6FA;
    --success: #22c55e;
    --accent: #6366F1;
  }
  
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
  
  body {
    margin: 0;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    min-height: 100vh;
    color: var(--dark);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px;
    user-select: none;
  }
  
  header {
    width: 100%;
    max-width: 440px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    gap: 8px;
  }
  
  h1 { 
    margin: 0; 
    font-size: 16px; 
    font-weight: 700; 
    color: white;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
  }
  
  .header-left {
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 0;
    flex-shrink: 1;
  }
  
  .puzzle-type-badge {
    font-size: 20px;
    cursor: pointer;
    padding: 2px 8px;
    border-radius: 8px;
    background: rgba(255,255,255,0.15);
    transition: background 0.2s;
    line-height: 1.2;
  }
  
  .puzzle-type-badge:hover {
    background: rgba(255,255,255,0.25);
  }
  
  .badge-tooltip {
    position: fixed;
    top: 50px;
    left: 12px;
    background: white;
    border-radius: 10px;
    padding: 12px 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    z-index: 1000;
    max-width: 280px;
    display: none;
    font-size: 13px;
    line-height: 1.5;
    color: var(--dark);
  }
  
  .badge-tooltip.show { display: block; }
  
  .badge-tooltip-content strong {
    color: var(--accent);
  }
  
  .header-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  
  .help-btn, .gallery-btn {
    padding: 6px 12px;
    border-radius: 16px;
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    font-weight: 600;
    font-size: 12px;
    cursor: pointer;
  }
  
  .moves {
    background: rgba(255,255,255,0.15);
    color: white;
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
  }
  
  .puzzle-nav {
    width: 100%;
    max-width: 440px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    color: white;
  }
  
  .nav-btn {
    padding: 8px 14px;
    border-radius: 16px;
    background: rgba(255,255,255,0.15);
    border: none;
    color: white;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
  }
  
  .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
  
  .puzzle-counter { font-size: 13px; opacity: 0.8; }
  
  .progress-indicator {
    font-size: 11px;
    opacity: 0.7;
    margin-top: 2px;
  }
  
  .nav-center {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .next-unsolved-btn {
    padding: 6px 10px;
    border-radius: 12px;
    background: var(--success);
    border: none;
    color: white;
    font-weight: 600;
    font-size: 11px;
    cursor: pointer;
    margin-left: 6px;
  }
  
  .next-unsolved-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 100;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  
  .modal-overlay.show { display: flex; }
  
  .modal {
    background: white;
    border-radius: 16px;
    max-width: 500px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 18px;
    border-bottom: 1px solid #eee;
    position: sticky;
    top: 0;
    background: white;
  }
  
  .modal-header h2 { margin: 0; font-size: 16px; }
  
  .modal-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: #f0f0f0;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-body { padding: 16px; }
  .modal-body p { margin: 0 0 12px 0; font-size: 13px; line-height: 1.5; color: #444; }
  
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
  }
  
  .gallery-item {
    background: #f5f5f5;
    border: 2px solid #ddd;
    border-radius: 10px;
    padding: 12px 8px;
    cursor: pointer;
    text-align: center;
    position: relative;
  }
  
  .gallery-item:hover { border-color: var(--accent); }
  .gallery-item.current { border-color: var(--accent); background: #eef2ff; }
  .gallery-item.solved { border-color: var(--success); background: #f0fdf4; }
  
  .gallery-title { font-size: 11px; font-weight: 600; color: var(--dark); }
  .gallery-number { font-size: 10px; color: #888; margin-top: 3px; }
  
  .gallery-badge {
    position: absolute;
    top: 4px;
    left: 4px;
    font-size: 12px;
    line-height: 1;
  }
  
  .solved-check {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 16px;
    height: 16px;
    background: var(--success);
    border-radius: 50%;
    color: white;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .solved-banner {
    width: 100%;
    max-width: 440px;
    background: var(--success);
    color: white;
    text-align: center;
    padding: 10px;
    border-radius: 10px;
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 8px;
    display: none;
  }
  
  .solved-banner.show {
    display: block;
    animation: celebrate 0.4s ease-in-out 3;
  }
  
  @keyframes celebrate {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }
  
  .board {
    position: relative;
    width: var(--size);
    height: var(--size);
    background: rgba(255,255,255,0.95);
    border-radius: 50%;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }
  
  svg.board-svg {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  }
  
  .slice {
    stroke: rgba(255,255,255,0.8);
    stroke-width: 2;
    fill-opacity: 0.25;
    transition: fill-opacity 0.3s;
  }
  
  .slice.correct { fill-opacity: 0.45; }
  
  .theme-label {
    font: 700 12px sans-serif;
    fill: var(--dark);
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.8;
  }
  
  @media (max-width: 480px) {
    .theme-label {
      font-size: 14px;
      font-weight: 800;
    }
  }
  
  .drop {
    position: absolute;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    cursor: pointer;
  }
  
  .drop.anchor { width: 76px; height: 76px; border-radius: 50%; }
  .drop.bridge { width: 84px; height: 42px; border-radius: 21px; }
  .drop.selected { background: rgba(99, 102, 241, 0.15); }
  
  .token {
    padding: 10px 14px;
    background: white;
    border: 2px solid var(--dark);
    border-radius: 18px;
    font-weight: 700;
    font-size: 11px;
    color: var(--dark);
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  
  .token:hover { transform: scale(1.05); }
  
  .token.selected {
    background: #6366F1 !important;
    color: white !important;
    border-color: #6366F1 !important;
    transform: scale(1.08);
  }
  
  .token.correct {
    background: var(--success);
    color: white;
    border-color: var(--success);
  }

  .buttons {
    display: flex;
    gap: 10px;
    margin-top: 16px;
    width: 100%;
    max-width: 440px;
  }
  
  .btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
  }
  
  .btn-shuffle { background: var(--accent); color: white; }
  .btn-solve { background: rgba(255,255,255,0.2); color: white; }
  
  .explanations {
    width: 100%;
    max-width: 440px;
    text-align: center;
    margin-top: 8px;
    display: none;
  }
  
  .explanations.show { display: block; }
  
  .bridge-hint {
    font-size: 12px;
    color: rgba(255,255,255,0.7);
    font-style: italic;
  }

  /* Bridge tooltip */
  .bridge-tooltip {
    position: fixed;
    background: white;
    border-radius: 10px;
    padding: 12px 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    z-index: 1000;
    max-width: 280px;
    text-align: center;
    display: none;
  }
  
  .bridge-tooltip.show { display: block; }
  
  .bridge-tooltip-word {
    font-weight: 700;
    font-size: 14px;
    color: var(--success);
    margin-bottom: 6px;
  }
  
  .bridge-tooltip-meanings {
    font-size: 12px;
    color: #555;
  }
  
  .bridge-tooltip-meanings span {
    color: var(--accent);
    font-weight: 600;
  }

  /* Center circle */
  .center-circle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 70px;
    height: 70px;
    margin-top: -35px;
    margin-left: -35px;
    border-radius: 50%;
    background: white;
    border: 3px solid var(--dark);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    font-weight: 700;
    color: #aaa;
    cursor: default;
    z-index: 20;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: width 0.3s ease, height 0.3s ease, margin 0.3s ease, color 0.3s ease;
    text-align: center;
    line-height: 1;
  }
  
  .center-circle .letter-count {
    font-size: 24px;
    font-weight: 700;
    line-height: 1;
  }
  
  .center-circle .letter-label {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
  }
  
  .center-circle.show {
    color: var(--accent);
    cursor: pointer;
    animation: pulse 1.5s ease-in-out infinite;
    font-size: 12px;
    padding: 4px;
    border-color: var(--accent);
    border-width: 3px;
    background: linear-gradient(135deg, #eef2ff, #e0e7ff);
  }
  
  .center-circle.guessed {
    background: var(--success);
    border-color: var(--success);
    color: white;
    animation: none;
    cursor: default;
    font-size: 14px;
  }
  
  .center-circle.show:hover:not(.guessed) {
    box-shadow: 0 4px 15px rgba(0,0,0,0.2), 0 0 0 8px rgba(99, 102, 241, 0.3);
  }
  
  @keyframes pulse {
    0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.2), 0 0 0 0 rgba(99, 102, 241, 0.6); }
    50% { box-shadow: 0 4px 15px rgba(0,0,0,0.2), 0 0 0 15px rgba(99, 102, 241, 0); }
  }
  
  @keyframes celebrate-pop {
    0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    50% { box-shadow: 0 4px 25px rgba(34, 197, 94, 0.6), 0 0 0 15px rgba(34, 197, 94, 0.3); }
  }
  
  .center-circle.celebrate {
    animation: celebrate-pop 0.5s ease-out;
  }

  /* Guessing mode - expanded center */
  .center-circle.guessing-mode {
    width: 130px;
    height: 130px;
    margin-top: -65px;
    margin-left: -65px;
    background: linear-gradient(135deg, #eef2ff, #e0e7ff);
    border: 3px solid var(--accent);
    animation: none;
    cursor: default;
  }
  
  .center-circle.guessing-mode .center-input-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }
  
  .center-circle.guessing-mode .center-letter-count {
    font-size: 11px;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .center-circle.guessing-mode .center-input {
    width: 90px;
    height: 32px;
    border: 2px solid var(--accent);
    border-radius: 8px;
    font-size: 16px;
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    outline: none;
    background: white;
    color: var(--dark);
  }
  
  .center-circle.guessing-mode .center-input:focus {
    border-color: #4f46e5;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
  }
  
  .center-circle.guessing-mode .center-input.shake {
    animation: shake 0.4s ease;
  }
  
  .center-circle.guessing-mode .center-submit {
    margin-top: 6px;
    padding: 4px 16px;
    border: none;
    border-radius: 12px;
    background: var(--accent);
    color: white;
    font-size: 11px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  .center-circle.guessing-mode .center-submit:hover {
    background: #4f46e5;
  }
  
  /* Wrong guesses display in center */
  .center-wrong-guesses {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: center;
    margin-top: 4px;
    max-width: 110px;
  }
  
  .center-wrong-guess {
    font-size: 9px;
    color: #ef4444;
    text-decoration: line-through;
    font-weight: 600;
  }

  /* Hints panel below puzzle */
  .hints-panel {
    width: 100%;
    max-width: 440px;
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border: 2px solid #7dd3fc;
    border-radius: 12px;
    padding: 14px 16px;
    margin-top: 12px;
    display: none;
  }
  
  .hints-panel.show {
    display: block;
  }
  
  .hints-panel-header {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #0369a1;
    margin-bottom: 10px;
    text-align: center;
  }
  
  .hints-panel-instruction {
    font-size: 12px;
    color: #0369a1;
    text-align: center;
    margin-bottom: 12px;
    font-style: italic;
  }
  
  .hints-panel .hint-progress {
    justify-content: center;
    margin-bottom: 8px;
  }
  
  .hints-panel .hint-difficulty-labels {
    max-width: 200px;
    margin: 0 auto 10px;
  }
  
  .hints-panel .crossword-hints {
    margin-bottom: 12px;
  }
  
  .hints-panel .crossword-hint {
    padding: 8px 12px;
    margin-bottom: 6px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 13px;
    color: #334155;
    display: none;
  }
  
  .hints-panel .crossword-hint.revealed {
    display: block;
    background: white;
    border-color: #7dd3fc;
  }
  
  .hints-panel .get-hint-btn {
    width: 100%;
    padding: 10px 16px;
    border: none;
    border-radius: 20px;
    background: linear-gradient(135deg, #0ea5e9, #0284c7);
    color: white;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
  }
  
  .hints-panel .get-hint-btn:disabled {
    background: #94a3b8;
    cursor: not-allowed;
  }
  
  .hints-panel-buttons {
    display: flex;
    gap: 10px;
    margin-top: 12px;
  }
  
  .hints-panel-buttons button {
    flex: 1;
    padding: 10px 16px;
    border: none;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
  }
  
  .hints-panel-buttons .reveal-btn {
    background: #fecaca;
    color: #dc2626;
  }
  
  .hints-panel-buttons .reveal-btn:hover {
    background: #fca5a5;
  }

  /* Welcome screen */
  .welcome-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    z-index: 300;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 20px;
    overflow-y: auto;
  }
  
  .welcome-overlay.hidden { display: none; }
  
  .welcome-content {
    max-width: 500px;
    width: 100%;
    text-align: center;
    color: white;
  }
  
  .welcome-title {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: 3px;
    margin: 0 0 4px 0;
    background: linear-gradient(135deg, #6366F1, #8B5CF6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .welcome-tagline {
    font-size: 13px;
    opacity: 0.7;
    margin: 0 0 20px 0;
    letter-spacing: 1px;
  }
  
  .welcome-board {
    position: relative;
    width: 100%;
    max-width: 420px;
    aspect-ratio: 1;
    margin: 0 auto 24px;
  }
  
  .welcome-board svg {
    width: 100%;
    height: 100%;
  }
  
  .welcome-board .slice {
    stroke: rgba(255,255,255,0.8);
    stroke-width: 2;
    fill-opacity: 0.5;
  }
  
  .welcome-board .theme-label {
    fill: rgba(255,255,255,0.7);
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 2px;
  }
  
  .welcome-board .welcome-drop {
    position: absolute;
    background: white;
    border-radius: 14px;
    padding: 5px 12px;
    font-size: 11px;
    font-weight: 700;
    color: #1a1a2e;
    transform: translate(-50%, -50%);
    white-space: nowrap;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 10;
  }
  
  .welcome-board .center-word {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    color: #6366F1;
    font-size: 36px;
    font-weight: 800;
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    box-shadow: 0 4px 15px rgba(0,0,0,0.25);
  }
  
  .welcome-instructions {
    text-align: left;
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 24px;
  }
  
  .welcome-instructions h2 {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 16px;
    text-align: center;
  }
  
  .instruction-item {
    margin-bottom: 16px;
    line-height: 1.5;
  }
  
  .instruction-item:last-child {
    margin-bottom: 0;
  }
  
  .instruction-item strong {
    color: #a5b4fc;
  }
  
  .instruction-label {
    font-weight: 700;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.6;
    margin-bottom: 4px;
  }
  
  .bridge-demo {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 8px;
    background: rgba(0,0,0,0.2);
    padding: 10px 14px;
    border-radius: 8px;
  }
  
  .bridge-word-chip {
    background: white;
    color: #1a1a2e;
    font-weight: 700;
    padding: 6px 14px;
    border-radius: 16px;
    font-size: 12px;
  }
  
  .bridge-meanings {
    font-size: 13px;
    line-height: 1.5;
  }
  
  .meaning-line {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .meaning-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  
  .welcome-btn {
    width: 100%;
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    background: linear-gradient(135deg, #6366F1, #8B5CF6);
    color: white;
    margin-bottom: 16px;
    transition: transform 0.15s, box-shadow 0.15s;
  }
  
  .welcome-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }
  
  .welcome-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    opacity: 0.5;
  }
  
  .welcome-skip {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }
  
  .welcome-skip:hover {
    opacity: 0.8;
  }
  
  .welcome-skip input {
    cursor: pointer;
  }

  /* Guess modal */
  .guess-modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 200;
    align-items: flex-start;
    justify-content: center;
    padding: 20px 0;
    overflow-y: auto;
  }
  
  .guess-modal.show { display: flex; }
  
  .guess-modal:focus { outline: none; }
  
  .guess-content {
    background: white;
    border-radius: 16px;
    padding: 20px 24px 24px;
    max-width: 440px;
    width: calc(100% - 24px);
    margin: 0 12px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }
  
  .guess-content h3 {
    margin: 0 0 8px 0;
    font-size: 18px;
    color: var(--dark);
  }
  
  .guess-content p {
    margin: 0 0 16px 0;
    font-size: 13px;
    color: #666;
  }
  
  .guess-btn.submit { background: var(--accent); color: white; }
  .guess-btn.cancel { background: #eee; color: #666; }
  .guess-btn.reveal { background: rgba(239, 68, 68, 0.15); color: #dc2626; border: 1px solid #dc2626; }
  
  .guess-buttons {
    display: flex;
    gap: 10px;
  }
  
  .guess-btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
  }
  
  .guess-input {
    width: 100%;
    padding: 14px 16px;
    font-size: 18px;
    font-weight: 700;
    text-align: center;
    text-transform: uppercase;
    border: 3px solid #ddd;
    border-radius: 10px;
    margin-bottom: 12px;
    outline: none;
    transition: border-color 0.2s;
  }
  
  .guess-input:focus {
    border-color: var(--accent);
  }
  
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
  }
  
  .guess-input.shake {
    animation: shake 0.4s ease;
  }
  
  .wrong-guesses {
    margin-bottom: 12px;
    min-height: 20px;
  }
  
  .wrong-guess {
    display: inline-block;
    padding: 4px 10px;
    margin: 3px;
    background: #fee2e2;
    color: #dc2626;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    text-decoration: line-through;
  }
  
  .theme-meanings {
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border: 2px solid #7dd3fc;
    border-radius: 10px;
    padding: 12px 14px;
    margin-bottom: 14px;
    text-align: left;
  }
  
  .theme-meanings-header {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #0369a1;
    margin-bottom: 8px;
    text-align: center;
  }
  
  .themes-display {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 14px;
  }
  
  .theme-display-item {
    background: white;
    border: 2px solid #e2e8f0;
    border-left-width: 4px;
    border-radius: 6px;
    padding: 8px 10px;
    font-size: 12px;
    font-weight: 700;
    color: #334155;
    text-align: center;
  }
  
  .hint-difficulty-labels {
    display: flex;
    justify-content: space-between;
    font-size: 10px;
    color: #64748b;
    margin-bottom: 6px;
    padding: 0 4px;
  }
  
  .hint-progress {
    display: flex;
    gap: 6px;
    margin-bottom: 12px;
  }
  
  .hint-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #e2e8f0;
    border: 2px solid #cbd5e1;
    transition: all 0.3s ease;
  }
  
  .hint-dot.revealed {
    background: #0ea5e9;
    border-color: #0284c7;
  }
  
  .hint-dot.current {
    background: #fbbf24;
    border-color: #f59e0b;
    animation: hintPulse 1.5s infinite;
  }
  
  @keyframes hintPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }
  
  .crossword-hints {
    margin-bottom: 12px;
  }
  
  .crossword-hint {
    padding: 10px 12px;
    margin-bottom: 6px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    color: #334155;
    display: none;
  }
  
  .crossword-hint.revealed {
    display: block;
    background: white;
    border-color: #7dd3fc;
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .crossword-hint .hint-number {
    font-weight: 700;
    color: #0369a1;
    margin-right: 8px;
  }
  
  .crossword-hint .hint-difficulty {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    float: right;
  }
  
  .crossword-hint .hint-difficulty.friday { background: #fef3c7; color: #92400e; }
  .crossword-hint .hint-difficulty.thursday { background: #fee2e2; color: #991b1b; }
  .crossword-hint .hint-difficulty.wednesday { background: #dbeafe; color: #1e40af; }
  .crossword-hint .hint-difficulty.tuesday { background: #dcfce7; color: #166534; }
  
  .get-hint-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #0ea5e9, #0284c7);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 8px;
    transition: all 0.2s ease;
  }
  
  .get-hint-btn:hover {
    background: linear-gradient(135deg, #0284c7, #0369a1);
    transform: translateY(-1px);
  }
  
  .get-hint-btn:disabled {
    background: #94a3b8;
    cursor: not-allowed;
    transform: none;
  }
  
  .theme-hint-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    margin-bottom: 6px;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .theme-hint-row:last-child {
    margin-bottom: 0;
  }
  
  .theme-hint-row:hover:not(.revealed) {
    border-color: #94a3b8;
    background: #f1f5f9;
  }
  
  .theme-hint-row.revealed {
    cursor: default;
    background: white;
    border-color: #7dd3fc;
  }
  
  .theme-hint-label {
    font-weight: 700;
    font-size: 11px;
    text-transform: uppercase;
  }
  
  .theme-hint-tap {
    font-size: 11px;
    color: #94a3b8;
    font-style: italic;
  }
  
  .theme-hint-text {
    color: #1e3a5f;
    font-style: italic;
    font-size: 13px;
  }

  .guess-result {
    text-align: center;
    padding: 12px;
    border-radius: 8px;
    margin-top: 12px;
    font-weight: 700;
  }
  
  .guess-result.success {
    background: #dcfce7;
    color: #166534;
  }
  
  .guess-result.failure {
    background: #fef2f2;
    color: #991b1b;
  }

  /* Center word panel */
  .center-panel {
    width: 100%;
    max-width: 440px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    padding: 14px 16px;
    margin-top: 12px;
    display: none;
    border: 2px solid var(--success);
  }
  
  .center-panel.show { display: block; }
  
  .center-panel h3 {
    margin: 0 0 10px 0;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--success);
    text-align: center;
  }
  
  .center-word-display {
    font-size: 24px;
    font-weight: 800;
    color: var(--dark);
    text-align: center;
    margin-bottom: 12px;
    padding: 8px;
    background: linear-gradient(135deg, #f0fdf4, #dcfce7);
    border-radius: 8px;
  }
  
  .center-panel-item {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid #eee;
    font-size: 12px;
  }
  
  .center-panel-item:last-child { border-bottom: none; }
  .center-panel-theme { color: #666; }
  .center-panel-meaning { color: var(--dark); font-weight: 600; }
  
  .center-guess-info {
    text-align: center;
    padding: 10px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 12px;
  }
  
  .center-guess-info.success {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    color: #166534;
  }
  
  .center-guess-info.failure {
    background: #fef2f2;
    color: #991b1b;
  }
  
  .score-display {
    text-align: center;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    background: linear-gradient(135deg, #eef2ff, #e0e7ff);
    border: 2px solid var(--accent);
  }
  
  .score-number {
    font-size: 32px;
    font-weight: 800;
    color: var(--accent);
    line-height: 1;
  }
  
  .score-label {
    font-size: 16px;
    font-weight: 700;
    margin-top: 4px;
  }
  
  .score-label.brilliant { color: #7c3aed; }
  .score-label.sharp { color: #2563eb; }
  .score-label.solid { color: #059669; }
  .score-label.grinder { color: #d97706; }
  .score-label.revealed { color: #dc2626; }
  
  .score-breakdown {
    font-size: 11px;
    color: #666;
    margin-top: 6px;
  }
</style>
</head>
<body>

<!-- Welcome Screen -->
<div class="welcome-overlay" id="welcome-overlay">
  <div class="welcome-content">
    <h1 class="welcome-title">ASSOCIOLOGY</h1>
    <p class="welcome-tagline">The Word Association Game</p>
    
    <!-- Ring matching actual game layout -->
    <div class="welcome-board" id="welcome-board">
      <svg class="board-svg" id="welcome-svg" viewBox="0 0 500 500">
        <defs id="welcome-defs"></defs>
        <g id="welcome-slices"></g>
        <g id="welcome-labels"></g>
      </svg>
      <div class="center-word">?</div>
    </div>
    
    <!-- Clear instructions -->
    <div class="welcome-instructions">
      <h2>How to Play</h2>
      
      <div class="instruction-item">
        <div class="instruction-label">The Ring</div>
        The ring has <strong>4 themed quadrants</strong>. Each quadrant has 2 words that belong to it.
      </div>
      
      <div class="instruction-item">
        <div class="instruction-label">Anchors vs Bridges</div>
        <strong>4 words are "anchors"</strong> ‚Äî they belong to just ONE theme.<br>
        <strong>4 words are "bridges"</strong> ‚Äî they connect TWO adjacent themes.
        
        <div class="bridge-demo">
          <div class="bridge-word-chip">LINE</div>
          <div class="bridge-meanings">
            <div class="meaning-line">
              <span class="meaning-dot" style="background: #3B82F6;"></span>
              <span>Fishing string</span>
            </div>
            <div class="meaning-line">
              <span class="meaning-dot" style="background: #EC4899;"></span>
              <span>Spoken dialogue</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="instruction-item">
        <div class="instruction-label">Your Goal</div>
        <strong>Tap two words to swap them.</strong> Arrange all 8 words correctly, then guess the mystery center word ‚Äî one word that connects to all 4 themes.
        <div style="margin-top: 8px; font-size: 12px; opacity: 0.85; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 8px;">
          <strong>üìñ Classic</strong> puzzles use dictionary words throughout.<br>
          <strong>üåç Cultural</strong> puzzles may include famous names, brands, or places ‚Äî as the mystery word or even among the clues.
        </div>
      </div>
    </div>
    
    <button class="welcome-btn" onclick="startPlaying()">Play</button>
    
    <div class="welcome-footer">
      <label class="welcome-skip">
        <input type="checkbox" id="skip-welcome-checkbox" />
        <span>Don't show this again</span>
      </label>
      <span>41 puzzles</span>
    </div>
  </div>
</div>

<header>
  <div class="header-left">
    <h1 id="puzzle-title">Puzzle 1</h1>
    <span class="puzzle-type-badge" id="puzzle-type-badge" onclick="toggleBadgeTooltip()">üìñ</span>
  </div>
  <div class="header-right">
    <button class="gallery-btn" onclick="openGallery()">Gallery</button>
    <button class="help-btn" onclick="openHelp()">How to Play</button>
    <div class="moves">Moves: <span id="move-count">0</span></div>
  </div>
</header>

<div class="badge-tooltip" id="badge-tooltip">
  <div class="badge-tooltip-content" id="badge-tooltip-content"></div>
</div>

<nav class="puzzle-nav">
  <button class="nav-btn" id="prev-btn" onclick="prevPuzzle()">‚Üê Prev</button>
  <div class="nav-center">
    <span class="puzzle-counter"><span id="current-num">1</span> / <span id="total-num">25</span></span>
    <span class="progress-indicator" id="progress-indicator">0 solved</span>
  </div>
  <div style="display: flex; align-items: center;">
    <button class="nav-btn" id="next-btn" onclick="nextPuzzle()">Next ‚Üí</button>
    <button class="next-unsolved-btn" id="next-unsolved-btn" onclick="nextUnsolved()">‚ñ∂ Unsolved</button>
  </div>
</nav>

<div class="solved-banner" id="solved-banner">
  üéâ Stage 1 solved in <span id="final-moves">0</span> moves! <strong>Tap the center</strong> to guess the word...
</div>

<div class="board" id="board">
  <svg class="board-svg" id="svg" viewBox="0 0 500 500">
    <g id="slices"></g>
    <g id="labels"></g>
  </svg>
  <div class="center-circle" id="center-circle" onclick="openGuessModal()">?</div>
</div>

<div class="buttons" id="game-buttons">
  <button class="btn btn-shuffle" onclick="shuffle()">Shuffle</button>
  <button class="btn btn-solve" onclick="solve()">Reveal</button>
</div>

<div class="explanations" id="explanations">
  <div class="bridge-hint">Tap any word to see its meaning</div>
</div>

<div class="hints-panel" id="hints-panel">
  <div class="hints-panel-header">Crossword Clues</div>
  <div class="hints-panel-instruction">Tap ring words to see meanings ‚Äî they may help!</div>
  <div class="hint-progress" id="hints-progress"></div>
  <div class="hint-difficulty-labels"><span>Harder</span><span>Easier</span></div>
  <div class="crossword-hints" id="hints-container"></div>
  <button class="get-hint-btn" id="panel-hint-btn">Get Hint (4 remaining)</button>
  <div class="hints-panel-buttons">
    <button class="reveal-btn" onclick="revealAnswer()">Show Answer</button>
  </div>
</div>

<div class="bridge-tooltip" id="bridge-tooltip">
  <div class="bridge-tooltip-word" id="tooltip-word"></div>
  <div class="bridge-tooltip-meanings" id="tooltip-meanings"></div>
</div>

<div class="center-panel" id="center-panel">
  <h3>‚ú® Center Word</h3>
  <div class="center-word-display" id="center-word-display"></div>
  <div id="center-panel-list"></div>
</div>

<div class="guess-modal" id="guess-modal" tabindex="-1">
  <div class="guess-content">
    <h3>Mystery Center Word</h3>
    <p id="guess-subtitle">What single word connects ALL of these?</p>
    <div class="theme-meanings" id="theme-meanings"></div>
    <div class="wrong-guesses" id="wrong-guesses"></div>
    <input type="text" class="guess-input" id="guess-input" placeholder="Type your answer..." autocomplete="off" autocapitalize="characters" spellcheck="false">
    <div class="guess-buttons">
      <button class="guess-btn cancel" onclick="closeGuessModal()">Cancel</button>
      <button class="guess-btn reveal" onclick="revealFromModal()">Reveal</button>
      <button class="guess-btn submit" onclick="submitGuess()">Submit</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="help-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>How to Play</h2>
      <button class="modal-close" onclick="closeHelp()">√ó</button>
    </div>
    <div class="modal-body">
      <p><strong>Stage 1 ‚Äî Arrange the Ring</strong></p>
      <p>Place 8 words around the ring so each belongs to its correct theme(s). <strong>Anchors</strong> (inside quadrants) belong to ONE theme. <strong>Bridges</strong> (on boundaries) belong to TWO adjacent themes.</p>
      <p>Tap two words to swap them. Bridges show split coloring as you solve ‚Äî only the half inside a completed quadrant turns green.</p>
      <p><strong>Stage 2 ‚Äî Find the Center Word</strong></p>
      <p>Once all words are placed, tap the center to enter guessing mode. The center expands so you can type your answer directly into it.</p>
      <p>The mystery word connects ALL 4 themes through different meanings. For example, if the themes were THEATER, FISHING, MEDICINE, and METALWORK, the center word might be CAST (cast of actors / cast a line / arm cast / cast molten metal).</p>
      <p><strong>Use the ring words!</strong> Tap any word on the ring to see how it connects to its theme(s) ‚Äî this may help you find the center word.</p>
      <p><strong>Need more help?</strong> Use the "Get Hint" button below the puzzle to reveal crossword-style clues, progressing from harder to easier. Use fewer hints for a better score!</p>
      <p>You have <strong>4 attempts</strong> to guess the correct word. Good luck!</p>
      <p><strong>üìñ Classic</strong> puzzles use dictionary words throughout.<br>
      <strong>üåç Cultural</strong> puzzles may include famous names, brands, or places ‚Äî as the mystery word or even among the clues.</p>
    </div>
  </div>
</div>

<div class="modal-overlay" id="gallery-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>Puzzle Gallery</h2>
      <button class="modal-close" onclick="closeGallery()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="gallery-grid" id="gallery-grid"></div>
    </div>
  </div>
</div>

<script>
const PUZZLES = [
  { id: 1, title: "Break a Leg", themes: ["THEATER", "MEDICINE", "METALWORK", "FISHING"], colors: ["#EC4899", "#EF4444", "#6B7280", "#3B82F6"], solution: { 0: "STAGE", 1: "SUTURE", 2: "BRACE", 3: "ANVIL", 4: "HOOK", 5: "REEL", 6: "LINE", 7: "BOW" }, bridges: { "STAGE": ["Performance platform", "Illness progression"], "BRACE": ["Orthopedic support", "Structural support"], "HOOK": ["Curved metal tool", "Fishing barb"], "LINE": ["Fishing string", "Spoken dialogue"] }, anchors: { "SUTURE": "Surgical stitches", "ANVIL": "Blacksmith's block", "REEL": "Line spool", "BOW": "Curtain call gesture" }, centerWord: "CAST", centerHints: ["It goes on a break", "Ones making a scene?", "Start angling", "Group of actors"], centerExplanations: { "THEATER": "The cast of a play", "MEDICINE": "A plaster cast", "FISHING": "Cast a line", "METALWORK": "Cast metal in a mold" } },
  { id: 2, title: "Out of the Blue", themes: ["MECHANICAL", "STORM", "SUDDEN MOVEMENT", "SEWING"], colors: ["#6B7280", "#3B82F6", "#F59E0B", "#EC4899"], solution: { 0: "WIND", 1: "HAIL", 2: "SURGE", 3: "DASH", 4: "DART", 5: "SEAM", 6: "PIN", 7: "AXLE" }, bridges: { "WIND": ["Wind up a mechanism", "Gale force air"], "SURGE": ["Storm surge", "Rush forward"], "DART": ["Move suddenly", "Sewn fold for shaping"], "PIN": ["Sewing tool", "Mechanical fastener"] }, anchors: { "HAIL": "Ice pellets from sky", "DASH": "Sprint quickly", "SEAM": "Stitched fabric edge", "AXLE": "Wheel shaft" }, centerWord: "BOLT", centerHints: ["Fabric purchase", "Aptly named Olympics star", "Zeus's weapon", "Nut's partner"], centerExplanations: { "MECHANICAL": "A nut and bolt", "STORM": "A bolt of lightning", "SUDDEN MOVEMENT": "Bolt out the door", "SEWING": "A bolt of fabric" } },
  { id: 3, title: "Diamond in the Rough", themes: ["SPORTS", "MASONRY", "COLORS", "JEWELRY"], colors: ["#22C55E", "#78716C", "#8B5CF6", "#06B6D4"], solution: { 0: "MARBLE", 1: "GRANITE", 2: "BRICK", 3: "TAUPE", 4: "JADE", 5: "GEM", 6: "DIAMOND", 7: "CURLING" }, bridges: { "MARBLE": ["Game piece", "Type of stone"], "BRICK": ["Building block", "Reddish-brown hue"], "JADE": ["Greenish hue", "Ornamental stone"], "DIAMOND": ["Precious stone", "Baseball field"] }, anchors: { "GRANITE": "Igneous rock", "TAUPE": "Brownish-grey hue", "GEM": "Cut precious stone", "CURLING": "Ice sport with brooms" }, centerWord: "STONE", centerHints: ["14 pounds, in Britain", "Curling disc", "Peach pit", "Rock"], centerExplanations: { "SPORTS": "A curling stone", "MASONRY": "Stone masonry", "JEWELRY": "A precious stone", "COLORS": "Stone grey" } },
  { id: 4, title: "Ink and Iron", themes: ["MEDIA", "PRINTING", "WEIGHTS", "LAUNDRY"], colors: ["#6366F1", "#1F2937", "#EF4444", "#06B6D4"], solution: { 0: "COPY", 1: "SERIF", 2: "PLATE", 3: "SQUAT", 4: "IRON", 5: "STARCH", 6: "SPIN", 7: "SCOOP" }, bridges: { "COPY": ["Written material", "Text for printing"], "PLATE": ["Metal printing sheet", "Weighted disc"], "IRON": ["Pump iron", "Pressing tool"], "SPIN": ["Washing cycle", "Present with bias"] }, anchors: { "SERIF": "Letter stroke flourish", "SQUAT": "Deep knee bend exercise", "STARCH": "Fabric stiffener", "SCOOP": "Exclusive news story" }, centerWord: "PRESS", centerHints: ["Court defense?", "Juice extractor", "De-crease?", "Fourth Estate"], centerExplanations: { "MEDIA": "The press corps", "PRINTING": "A printing press", "LAUNDRY": "Press a shirt", "WEIGHTS": "Bench press" } },
  { id: 5, title: "Bits and Pieces", themes: ["FIGHTING", "COMEDY", "TOOLS", "COCKTAILS"], colors: ["#EF4444", "#FBBF24", "#78716C", "#EC4899"], solution: { 0: "RIPOSTE", 1: "SKIT", 2: "BIT", 3: "AWL", 4: "SCREWDRIVER", 5: "CHASER", 6: "SMASH", 7: "UPPERCUT" }, bridges: { "RIPOSTE": ["Quick counter-attack", "Witty comeback"], "BIT": ["Comedy routine", "Drill attachment"], "SCREWDRIVER": ["Tool for screws", "Vodka cocktail"], "SMASH": ["Cocktail with fruit", "Powerful hit"] }, anchors: { "SKIT": "Short comedy sketch", "AWL": "Pointed leather tool", "CHASER": "Drink after a shot", "UPPERCUT": "Upward boxing blow" }, centerWord: "PUNCH", centerHints: ["Right or left", "Forcefulness", "Hero of children's puppet show", "Contents of a big bowl"], centerExplanations: { "FIGHTING": "Throw a punch", "COMEDY": "The punch line", "COCKTAILS": "Fruit punch", "TOOLS": "A hole punch" } },
  { id: 6, title: "Just My Type", themes: ["LAW", "TYPE", "MEDICAL", "GRAMMAR"], colors: ["#1F2937", "#6366F1", "#EF4444", "#22C55E"], solution: { 0: "CAPITAL", 1: "FONT", 2: "STROKE", 3: "PATIENT", 4: "COMPOUND", 5: "PRONOUN", 6: "SENTENCE", 7: "SUIT" }, bridges: { "CAPITAL": ["Punishable by death", "Uppercase letter"], "STROKE": ["Pen mark", "Cerebrovascular event"], "COMPOUND": ["Custom pharmacy preparation", "Joined clause"], "SENTENCE": ["Grammatical unit", "Court punishment"] }, anchors: { "FONT": "Typeface design", "PATIENT": "Person under care", "PRONOUN": "Word replacing noun", "SUIT": "Legal action" }, centerWord: "CASE", centerHints: ["Jewelry store feature", "Carryall", "Four six-packs", "Job for Sherlock"], centerExplanations: { "LAW": "A court case", "TYPE": "Upper case letters", "GRAMMAR": "Grammatical case", "MEDICAL": "A medical case" } },
  { id: 7, title: "Raise the Stakes", themes: ["VENTURE", "BASEBALL", "MUSIC", "TENTS"], colors: ["#6366F1", "#EF4444", "#EC4899", "#22C55E"], solution: { 0: "ANGELS", 1: "HOME", 2: "HITS", 3: "ALBUM", 4: "COVER", 5: "CAMPING", 6: "STAKE", 7: "UNICORN" }, bridges: { "ANGELS": ["Angel investors", "LA baseball team"], "HITS": ["Successful at-bats", "Popular songs"], "COVER": ["Song remake", "Tent protection"], "STAKE": ["Tent peg", "Equity share"] }, anchors: { "HOME": "Base or plate", "ALBUM": "Song collection", "CAMPING": "Outdoor overnight stay", "UNICORN": "Billion-dollar startup" }, centerWord: "PITCH", centerHints: ["Hull sealer", "Topic for a voice coach", "Word before or after perfect", "Sales spiel"], centerExplanations: { "VENTURE": "A startup pitch", "BASEBALL": "Pitch the ball", "TENTS": "Pitch a tent", "MUSIC": "Perfect pitch" } },
  { id: 8, title: "That's a Wrap", themes: ["MOVEMENT", "FOOD", "FILM", "MUSIC"], colors: ["#F59E0B", "#22C55E", "#6366F1", "#EC4899"], solution: { 0: "SHAKE", 1: "BUN", 2: "STOCK", 3: "FLICK", 4: "SCORE", 5: "STAFF", 6: "RHYTHM", 7: "TUMBLE" }, bridges: { "SHAKE": ["Move quickly", "Milkshake"], "STOCK": ["Food broth", "Film stock"], "SCORE": ["Film soundtrack", "Written music"], "RHYTHM": ["Musical beat", "Movement pattern"] }, anchors: { "BUN": "Bread for burgers", "FLICK": "Informal term for movie", "STAFF": "Musical notation lines", "TUMBLE": "Fall or somersault" }, centerWord: "ROLL", centerHints: ["Casino action", "Order to make a scene?", "Drum sound", "Item in a restaurant basket"], centerExplanations: { "MOVEMENT": "Roll over", "FOOD": "A dinner roll", "MUSIC": "A drum roll", "FILM": "A roll of film" } },
  { id: 9, title: "Ink Slinger", themes: ["ENTERTAINMENT", "COMIC BOOKS", "WATER", "FIREARMS"], colors: ["#EC4899", "#22C55E", "#3B82F6", "#6B7280"], solution: { 0: "SKETCH", 1: "PANEL", 2: "SPLASH", 3: "WELL", 4: "PUMP", 5: "GUN", 6: "CLIP", 7: "HEADLINER" }, bridges: { "SKETCH": ["Comedy bit", "Preliminary drawing"], "SPLASH": ["Full-page panel", "Water spray"], "PUMP": ["Water device", "Pump-action shotgun"], "CLIP": ["Ammo holder", "Video segment"] }, anchors: { "PANEL": "Comic frame", "WELL": "Underground water source", "GUN": "Handheld firearm", "HEADLINER": "Star performer" }, centerWord: "DRAW", centerHints: ["Duel action?", "Box office need", "Stalemate", "Sketch"], centerExplanations: { "ENTERTAINMENT": "The main draw", "COMIC BOOKS": "Draw a comic", "FIREARMS": "Quick draw", "WATER": "Draw water from a well" } },
  { id: 10, title: "Band of Gold", themes: ["MUSIC", "DESTABILIZE", "SCULPTURE", "JEWELRY"], colors: ["#EC4899", "#EF4444", "#78716C", "#FBBF24"], solution: { 0: "BEAT", 1: "JOLT", 2: "HAMMER", 3: "MARBLE", 4: "STONE", 5: "GEM", 6: "BAND", 7: "JAZZ" }, bridges: { "BEAT": ["Rhythm", "Defeat soundly"], "HAMMER": ["Criticize harshly", "Sculptor's tool"], "STONE": ["Carving material", "Precious gem"], "BAND": ["Ring", "Musical group"] }, anchors: { "JOLT": "Sudden shock", "MARBLE": "Sculptor's medium", "GEM": "Cut precious stone", "JAZZ": "Improvisational genre" }, centerWord: "ROCK", centerHints: ["Seesaw", "Swing alternative", "Sling missile", "Scissors topper, in a game"], centerExplanations: { "MUSIC": "Rock music", "DESTABILIZE": "Rock the boat", "JEWELRY": "A rock on her finger", "SCULPTURE": "Carved from rock" } },
  { id: 11, title: "Walk the Plank", themes: ["LUMBER", "NAUTICAL", "DINING", "GOVERNANCE"], colors: ["#92400E", "#3B82F6", "#F97316", "#6366F1"], solution: { 0: "DECK", 1: "SHIP", 2: "COURSE", 3: "MEAL", 4: "TABLE", 5: "MOTION", 6: "PANEL", 7: "PLANK" }, bridges: { "DECK": ["Wooden platform", "Floor of ship"], "COURSE": ["Ship's route", "Part of meal"], "TABLE": ["Dining furniture", "Postpone consideration"], "PANEL": ["Group of experts", "Wood sheet"] }, anchors: { "SHIP": "Seagoing vessel", "MEAL": "Prepared food", "MOTION": "Formal proposal", "PLANK": "Long wood piece" }, centerWord: "BOARD", centerHints: ["Cooperative people?", "Daily meals", "Two-by-four, for one", "What chess is played on"], centerExplanations: { "LUMBER": "A wooden board", "NAUTICAL": "Board a ship", "GOVERNANCE": "Board of directors", "DINING": "Room and board" } },
  { id: 12, title: "Off the Hook", themes: ["MUSIC", "FISH", "WEIGHING", "MAPS"], colors: ["#EC4899", "#3B82F6", "#6B7280", "#22C55E"], solution: { 0: "BASS", 1: "SOLE", 2: "NET", 3: "BALANCE", 4: "UNITS", 5: "GRID", 6: "KEY", 7: "TEMPO" }, bridges: { "BASS": ["Low pitch", "Type of fish"], "NET": ["Fishing tool", "Weight after deductions"], "UNITS": ["Weight measurement", "Map measurement"], "KEY": ["Map legend", "Tonal center"] }, anchors: { "SOLE": "Flatfish", "BALANCE": "Weighing device", "GRID": "Map coordinate lines", "TEMPO": "Speed of music" }, centerWord: "SCALE", centerHints: ["Union wage", "Run from a pianist", "It might reveal what you've lost", "Fixture in a post office or a doctor's office"], centerExplanations: { "MUSIC": "A musical scale", "FISH": "Fish scales", "MAPS": "Map scale", "WEIGHING": "A bathroom scale" } },
  { id: 13, title: "Around the Block", themes: ["SHAPES", "CITY", "FAIRNESS", "MATH"], colors: ["#6366F1", "#6B7280", "#22C55E", "#F59E0B"], solution: { 0: "BLOCK", 1: "PARK", 2: "BENCH", 3: "JUST", 4: "EVEN", 5: "PRIME", 6: "CUBE", 7: "OVAL" }, bridges: { "BLOCK": ["Solid cube shape", "City section"], "BENCH": ["Public seat", "Judge's seat"], "EVEN": ["Fair or equal", "Divisible by two"], "CUBE": ["Third power", "3D shape"] }, anchors: { "PARK": "Urban green space", "JUST": "Fair and righteous", "PRIME": "Number with two factors", "OVAL": "Elliptical shape" }, centerWord: "SQUARE", centerHints: ["Low power?", "Cat's opposite", "Even", "Equilateral quadrilateral"], centerExplanations: { "SHAPES": "A square shape", "CITY": "Times Square", "MATH": "Square a number", "FAIRNESS": "A square deal" } },
  { id: 14, title: "Crowned Heads", themes: ["CHECKERS", "CHESS", "CARDS", "MONARCHY"], colors: ["#1F2937", "#6366F1", "#EF4444", "#FBBF24"], solution: { 0: "BOARD", 1: "MATE", 2: "RANK", 3: "SUIT", 4: "COURT", 5: "REIGN", 6: "CROWN", 7: "JUMP" }, bridges: { "BOARD": ["Checkers surface", "Chess surface"], "RANK": ["Horizontal row", "Card value"], "COURT": ["Face cards", "Royal entourage"], "CROWN": ["Royal headgear", "Promote a piece"] }, anchors: { "MATE": "Checkmate", "SUIT": "Hearts or spades", "REIGN": "Royal rule period", "JUMP": "Checkers capture move" }, centerWord: "KING", centerHints: ["Hopper around a board", "It's worth zero in baccarat", "Hotel room option", "Double-decker checker"], centerExplanations: { "CHECKERS": "King me!", "CHESS": "The chess king", "MONARCHY": "A king on the throne", "CARDS": "King of hearts" } },
  { id: 15, title: "Crash Course", themes: ["VEHICLES", "COMPUTERS", "REMOVAL", "CATTLE HERDING"], colors: ["#EF4444", "#3B82F6", "#8B5CF6", "#22C55E"], solution: { 0: "CRASH", 1: "MOUSE", 2: "EJECT", 3: "REPEL", 4: "CULL", 5: "WRANGLE", 6: "STEER", 7: "WHEEL" }, bridges: { "CRASH": ["Vehicle accident", "System failure"], "EJECT": ["Eject disk", "Expel"], "CULL": ["Weed out", "Reduce herd"], "STEER": ["Male bovine", "Guide vehicle"] }, anchors: { "MOUSE": "Input device", "REPEL": "Drive away", "WRANGLE": "Herd livestock", "WHEEL": "Steering control" }, centerWord: "DRIVE", centerHints: ["Automatic selection?", "Sense of purpose", "Charity money-raiser", "Opening golf shot"], centerExplanations: { "VEHICLES": "Drive a car", "COMPUTERS": "A hard drive", "CATTLE HERDING": "A cattle drive", "REMOVAL": "Drive out the enemy" } },
  { id: 16, title: "Acid Test", themes: ["MATH", "CHEMISTRY", "MYSTERY", "CROSSWORDS"], colors: ["#F59E0B", "#22C55E", "#6366F1", "#78716C"], solution: { 0: "BASE", 1: "ACID", 2: "AGENT", 3: "CRIME", 4: "CLUE", 5: "DOWN", 6: "SQUARE", 7: "ROOT" }, bridges: { "BASE": ["Number system radix", "pH greater than 7"], "AGENT": ["Chemical substance", "Investigator"], "CLUE": ["Evidence in crime", "Puzzle hint"], "SQUARE": ["Grid box", "Number times itself"] }, anchors: { "ACID": "Corrosive compound", "CRIME": "Unlawful act", "DOWN": "Vertical clue direction", "ROOT": "Square or cube extraction" }, centerWord: "SOLUTION", centerHints: ["\"Eureka!\" cause", "Whodunit finale", "Holmes's aim", "Puzzle fan's goal"], centerExplanations: { "MATH": "The solution to the equation", "CHEMISTRY": "A saline solution", "CROSSWORDS": "The puzzle solution", "MYSTERY": "Solution to the mystery" } },
  { id: 17, title: "Perfect Match", themes: ["ROYALTY", "SPORTS", "ROMANCE", "LAW"], colors: ["#FBBF24", "#22C55E", "#EC4899", "#1F2937"], solution: { 0: "BALL", 1: "SQUASH", 2: "MATCH", 3: "FLAME", 4: "BOND", 5: "BRIEF", 6: "PEERS", 7: "THRONE" }, bridges: { "BALL": ["Formal dance", "Sports equipment"], "MATCH": ["Competition", "Marriage partner"], "BOND": ["Emotional connection", "Bail security"], "PEERS": ["Jury of peers", "Nobles"] }, anchors: { "SQUASH": "Racquet sport", "FLAME": "Romantic interest", "BRIEF": "Legal document", "THRONE": "Monarch's seat" }, centerWord: "COURT", centerHints: ["Jester's locale", "Woo", "Pickleball venue", "Legal setting"], centerExplanations: { "ROYALTY": "The royal court", "SPORTS": "A tennis court", "LAW": "A court of law", "ROMANCE": "Court a partner" } },
  { id: 18, title: "The Gambit", themes: ["GAMES", "ART", "FINANCE", "NEWS"], colors: ["#6366F1", "#EC4899", "#22C55E", "#6B7280"], solution: { 0: "MINIATURE", 1: "STATUE", 2: "LOT", 3: "SHARE", 4: "STOCK", 5: "SCOOP", 6: "CHECKER", 7: "KNIGHT" }, bridges: { "MINIATURE": ["Small game model", "Miniature painting"], "LOT": ["Auction item", "Bundle of shares"], "STOCK": ["Company share", "Stock photo"], "CHECKER": ["Game piece", "Fact-checker"] }, anchors: { "STATUE": "Sculpted figure", "SHARE": "Equity portion", "SCOOP": "Breaking story", "KNIGHT": "Chess piece" }, centerWord: "PIECE", centerHints: ["Heat unit?", "Saturday night special", "Work of art", "Jigsaw puzzle element"], centerExplanations: { "GAMES": "A game piece", "ART": "A piece of art", "NEWS": "A news piece", "FINANCE": "A piece of the action" } },
  { id: 19, title: "Fielder's Choice", themes: ["VEGETATION", "MATH", "ORIGIN", "SPORTS"], colors: ["#22C55E", "#F59E0B", "#6366F1", "#EF4444"], solution: { 0: "PLOT", 1: "LOG", 2: "BASE", 3: "SOURCE", 4: "HOME", 5: "PLAY", 6: "FIELD", 7: "LEAF" }, bridges: { "PLOT": ["Garden plot", "Plot points on graph"], "BASE": ["Exponent base", "Foundation"], "HOME": ["Homeland", "Home plate"], "FIELD": ["Playing surface", "Meadow"] }, anchors: { "LOG": "Logarithm", "SOURCE": "Point of origin", "PLAY": "Athletic competition", "LEAF": "Plant foliage" }, centerWord: "ROOT", centerHints: ["Underground part", "Number that multiplies by itself", "Cheer for team", "Ancestry"], centerExplanations: { "VEGETATION": "Plant roots", "MATH": "Square root", "SPORTS": "Root for the team", "ORIGIN": "Family roots" } },
  { id: 20, title: "Bubble Trouble", themes: ["FUEL", "MILITARY", "AQUARIUM", "MARKET"], colors: ["#F59E0B", "#6B7280", "#3B82F6", "#22C55E"], solution: { 0: "RESERVE", 1: "SHELL", 2: "MARINE", 3: "CORAL", 4: "BUBBLES", 5: "SLUMP", 6: "VOLUME", 7: "CRUDE" }, bridges: { "RESERVE": ["Backup supply", "Forces held back"], "MARINE": ["Military branch", "Saltwater tank"], "BUBBLES": ["Air in water", "Economic bubbles"], "VOLUME": ["Quantity traded", "Container capacity"] }, anchors: { "SHELL": "Artillery projectile", "CORAL": "Marine invertebrate", "SLUMP": "Market decline", "CRUDE": "Unrefined petroleum" }, centerWord: "TANK", centerHints: ["Fuel container", "Armored vehicle", "To crash", "Glass container for fish"], centerExplanations: { "FUEL": "A gas tank", "MILITARY": "A military tank", "MARKET": "Tank in the market", "AQUARIUM": "A fish tank" } },
  { id: 21, title: "Study Hall", themes: ["GRAMMAR", "ACADEMICS", "SCIENCE", "ROYALTY"], colors: ["#6366F1", "#F59E0B", "#22C55E", "#FBBF24"], solution: { 0: "PERIOD", 1: "MAJOR", 2: "STUDY", 3: "HYPOTHESIS", 4: "GRANT", 5: "THRONE", 6: "RULE", 7: "OBJECT" }, bridges: { "PERIOD": ["Punctuation mark", "Class time slot"], "STUDY": ["Review material", "Research investigation"], "GRANT": ["Research funding", "Bestowed land"], "RULE": ["Sovereign reign", "Linguistic guideline"] }, anchors: { "MAJOR": "Primary field of study", "HYPOTHESIS": "Testable prediction", "THRONE": "Royal seat", "OBJECT": "Grammatical receiver" }, centerWord: "SUBJECT", centerHints: ["Doer of action", "Course of study", "One under sovereign", "Experiment participant"], centerExplanations: { "GRAMMAR": "The subject of a sentence", "ACADEMICS": "A school subject", "ROYALTY": "A loyal subject", "SCIENCE": "A test subject" } },
  { id: 22, title: "Flash Point", themes: ["PHOTO", "IGNITION", "WORKLOAD", "EXPRESSION"], colors: ["#3B82F6", "#EF4444", "#6B7280", "#EC4899"], solution: { 0: "FLASH", 1: "EMBER", 2: "BURNOUT", 3: "BURDENSOME", 4: "HEAVY", 5: "FUNNY", 6: "TONE", 7: "LENS" }, bridges: { "FLASH": ["Camera flash", "Burst into flame"], "BURNOUT": ["Flame exhaustion", "Work exhaustion"], "HEAVY": ["Demanding effort", "Serious or intense"], "TONE": ["Attitude in speech", "Degree of lightness"] }, anchors: { "EMBER": "Glowing coal", "BURDENSOME": "Oppressively heavy", "FUNNY": "Comical or amusing", "LENS": "Camera optic" }, centerWord: "LIGHT", centerHints: ["Diaphanous", "Smoker's request", "Hardly serious", "End of a tunnel, proverbially"], centerExplanations: { "PHOTO": "Light for photography", "IGNITION": "Light a match", "EXPRESSION": "Light conversation", "WORKLOAD": "A light workload" } },
  { id: 23, title: "Cut to the Chase", themes: ["VIOLENCE", "ELIMINATION", "SYMBOLS", "ROCKERS"], colors: ["#EF4444", "#6B7280", "#6366F1", "#EC4899"], solution: { 0: "CUT", 1: "EXCISE", 2: "DASH", 3: "ASTERISK", 4: "SEAL", 5: "AXE", 6: "STING", 7: "STAB" }, bridges: { "CUT": ["Knife wound", "Remove or reduce"], "DASH": ["Strike out text", "Hyphen or em dash"], "SEAL": ["Official emblem", "Singer"], "STING": ["The Police frontman", "Sharp wound"] }, anchors: { "EXCISE": "Cut out or remove", "ASTERISK": "Star-shaped symbol", "AXE": "Guitar (slang)", "STAB": "Thrust with blade" }, centerWord: "SLASH", centerHints: ["Mark of Zorro?", "Fractional part?", "Web address punctuation", "Cut in a hurry"], centerExplanations: { "VIOLENCE": "Slash with a blade", "ELIMINATION": "Slash prices", "ROCKERS": "Slash, the guitarist", "SYMBOLS": "A forward slash" } },
  { id: 24, title: "Chain of Command", themes: ["PAPERWORK", "OS", "ARMY", "SHOP"], colors: ["#78716C", "#3B82F6", "#6B7280", "#F59E0B"], solution: { 0: "FOLDER", 1: "ICON", 2: "COMMAND", 3: "PLATOON", 4: "DRILL", 5: "VISE", 6: "STAMP", 7: "DOSSIER" }, bridges: { "FOLDER": ["Holds documents", "Directory"], "COMMAND": ["Command line", "Authority to give orders"], "DRILL": ["Training exercise", "Boring tool"], "STAMP": ["Steel punch", "Ink device"] }, anchors: { "ICON": "Desktop shortcut image", "PLATOON": "Military unit", "VISE": "Clamping tool", "DOSSIER": "Document collection" }, centerWord: "FILE", centerHints: ["Cabinet member?", "Rank's counterpart, on a chessboard", "Escape tool hidden in a cake", "Tool for nails"], centerExplanations: { "PAPERWORK": "A file folder", "OS": "A computer file", "SHOP": "A metal file", "ARMY": "Single file march" } },
  { id: 25, title: "Behind Bars", themes: ["PRISON", "MOBILE PHONE", "BIOLOGY", "BATTERY"], colors: ["#6B7280", "#3B82F6", "#22C55E", "#F59E0B"], solution: { 0: "BARS", 1: "ROAMING", 2: "CARRIER", 3: "CULTURE", 4: "LIFE", 5: "ALKALINE", 6: "CHARGE", 7: "WARDEN" }, bridges: { "BARS": ["Prison bars", "Signal bars"], "CARRIER": ["Phone carrier", "Disease carrier"], "LIFE": ["Living organisms", "Battery life"], "CHARGE": ["Criminal charge", "Electric charge"] }, anchors: { "ROAMING": "Off-network service", "CULTURE": "Grown microorganisms", "ALKALINE": "Battery chemistry type", "WARDEN": "Prison administrator" }, centerWord: "CELL", centerHints: ["It multiplies by dividing", "Spy group", "Sentence structure?", "Smallest unit of life"], centerExplanations: { "PRISON": "A prison cell", "MOBILE PHONE": "A cell phone", "BIOLOGY": "A living cell", "BATTERY": "A battery cell" } },
  { id: 26, title: "House Rules", themes: ["POLICE", "GOLF", "CARDS", "NIGHTLIFE"], colors: ["#3B82F6", "#22C55E", "#EF4444", "#8B5CF6"], solution: { 0: "TRAP", 1: "CADDIE", 2: "CHIP", 3: "SPADE", 4: "DECK", 5: "DISCO", 6: "BEAT", 7: "BADGE" }, bridges: { "TRAP": ["Speed trap", "Sand trap"], "CHIP": ["Chip shot", "Poker chip"], "DECK": ["DJ deck", "Deck of cards"], "BEAT": ["Walk the beat", "Musical beat"] }, anchors: { "CADDIE": "Bag carrier", "SPADE": "Black pointed suit", "DISCO": "Dance venue", "BADGE": "Officer's ID" }, centerWord: "CLUB", centerHints: ["Triple-decker", "Iron, e.g.", "Extracurricular group", "Neanderthal's weapon"], centerExplanations: { "POLICE": "A billy club", "GOLF": "A golf club", "CARDS": "Club suit", "NIGHTLIFE": "A night club" } },
  { id: 27, title: "Cross the Aisle", themes: ["BUILDING", "POLITICS", "BIRD", "PLANE"], colors: ["#6B7280", "#DC2626", "#22C55E", "#3B82F6"], solution: { 0: "LOBBY", 1: "LIBERAL", 2: "HAWK", 3: "BEAK", 4: "TAIL", 5: "JET", 6: "LANDING", 7: "ANNEX" }, bridges: { "LOBBY": ["Entrance lobby", "Political lobbying"], "HAWK": ["War hawk", "Bird of prey"], "TAIL": ["Feathered tail", "Aircraft tail"], "LANDING": ["Plane landing", "Stair landing"] }, anchors: { "LIBERAL": "Left-leaning ideology", "BEAK": "Bird's bill", "JET": "Aircraft type", "ANNEX": "Building addition" }, centerWord: "WING", centerHints: ["Section of a structure", "Left or right faction", "Feathered limb for flight", "Aircraft lifting surface"], centerExplanations: { "BUILDING": "The east wing", "POLITICS": "The political wing", "BIRD": "A bird's wing", "PLANE": "An airplane wing" } },
  { id: 28, title: "Walking the Line", themes: ["POLICE", "COOKING", "SPORTS", "MUSIC"], colors: ["#3B82F6", "#F97316", "#22C55E", "#EC4899"], solution: { 0: "GRILL", 1: "WHISK", 2: "BATTER", 3: "OPPONENT", 4: "SCORE", 5: "RHYTHM", 6: "RECORD", 7: "PATROL" }, bridges: { "GRILL": ["Interrogate suspect", "Cook over fire"], "BATTER": ["Cake mixture", "Baseball player"], "SCORE": ["Game points", "Sheet music"], "RECORD": ["Vinyl album", "Criminal history"] }, anchors: { "WHISK": "Egg beater", "OPPONENT": "Rival to defeat", "RHYTHM": "Musical timing", "PATROL": "Officer's rounds" }, centerWord: "BEAT", centerHints: ["The conductor keeps it", "Kerouac, e.g.", "Flatfoot's circuit", "Musical rhythm"], centerExplanations: { "POLICE": "Walk the beat", "COOKING": "Beat the eggs", "SPORTS": "Beat the competition", "MUSIC": "The musical beat" } },
  { id: 29, title: "The Oval Office", themes: ["CARS", "PRESIDENTS", "CROSSING", "ACTORS"], colors: ["#3B82F6", "#EF4444", "#10B981", "#F59E0B"], solution: { 0: "LINCOLN", 1: "KENNEDY", 2: "WASHINGTON", 3: "RIVER", 4: "BRIDGES", 5: "HOLLYWOOD", 6: "DRIVER", 7: "MUSTANG" }, bridges: { "LINCOLN": ["Car brand", "US President"], "WASHINGTON": ["US President", "Crossing the Delaware"], "BRIDGES": ["River structures", "Famous acting family"], "DRIVER": ["Adam Driver", "Car operator"] }, anchors: { "KENNEDY": "35th President", "RIVER": "Flowing waterway", "HOLLYWOOD": "Film industry hub", "MUSTANG": "Iconic pony car" }, centerWord: "FORD", centerHints: ["Focus provider?", "First assemblyman?", "Major employer in Detroit", "Nixon pardoner"], centerExplanations: { "CARS": "Ford Motor Company", "PRESIDENTS": "President Gerald Ford", "ACTORS": "Harrison Ford", "CROSSING": "Ford a river" } },
  { id: 30, title: "Golden Eye", themes: ["SPY", "FINANCE", "CHEMISTRY", "ADHESIVE"], colors: ["#1F2937", "#10B981", "#8B5CF6", "#EC4899"], solution: { 0: "SECURITY", 1: "ASSET", 2: "YIELD", 3: "ATOM", 4: "COMPOUND", 5: "GLUE", 6: "AGENT", 7: "SECRET" }, bridges: { "SECURITY": ["National Security", "Financial securities"], "YIELD": ["Investment return", "Chemical output"], "COMPOUND": ["Chemical substance", "Joint compound"], "AGENT": ["Bonding agent", "Secret agent"] }, anchors: { "ASSET": "Valuable holding", "ATOM": "Smallest unit", "GLUE": "Sticky adhesive", "SECRET": "Classified info" }, centerWord: "BOND", centerHints: ["M asset", "Get tight (with)", "Source of interest", "Strong connection"], centerExplanations: { "SPY": "James Bond", "FINANCE": "A savings bond", "CHEMISTRY": "A chemical bond", "ADHESIVE": "Bond two surfaces" } },
  { id: 31, title: "Force of Nature", themes: ["E-COMMERCE", "RAINFOREST", "RIVER", "GREEK MYTH"], colors: ["#F97316", "#22C55E", "#3B82F6", "#8B5CF6"], solution: { 0: "CLOUD", 1: "CANOPY", 2: "BASIN", 3: "DELTA", 4: "STYX", 5: "TITAN", 6: "ECHO", 7: "PRIME" }, bridges: { "CLOUD": ["Cloud computing (AWS)", "Rainforest cloud cover"], "BASIN": ["Amazon basin", "River drainage area"], "STYX": ["River of the underworld", "Boundary to Hades"], "ECHO": ["Repeating nymph", "Smart speaker"] }, anchors: { "CANOPY": "Forest upper layer", "DELTA": "River mouth formation", "TITAN": "Pre-Olympian god", "PRIME": "Membership service" }, centerWord: "AMAZON", centerHints: ["Its basin covers roughly 40% of South America", "One of a tribe of mythical warriors", "Seattle-based retail giant", "Bookseller ___.com"], centerExplanations: { "E-COMMERCE": "Amazon.com", "RAINFOREST": "The Amazon rainforest", "RIVER": "The Amazon River", "GREEK MYTH": "Amazon warriors" } },
  { id: 32, title: "Royal Flush", themes: ["MUSIC", "CHESS", "ROYALTY", "CARDS"], colors: ["#8B5CF6", "#1F2937", "#FBBF24", "#EF4444"], solution: { 0: "TEMPO", 1: "PAWN", 2: "CASTLE", 3: "THRONE", 4: "COURT", 5: "ACE", 6: "CLUB", 7: "FLAT" }, bridges: { "TEMPO": ["Musical timing", "Chess move efficiency"], "CASTLE": ["Rook's special move", "Royal fortress"], "COURT": ["Royal attendants", "Face cards"], "CLUB": ["Card suit", "Music venue"] }, anchors: { "PAWN": "Least valuable piece", "THRONE": "Sovereign's seat", "ACE": "Highest card", "FLAT": "Musical half-step down" }, centerWord: "QUEEN", centerHints: ["Powerful board member", "Doyenne", "Ruler of a hive", "Bohemian Rhapsody band"], centerExplanations: { "MUSIC": "Queen, the band", "CHESS": "The chess queen", "ROYALTY": "A reigning queen", "CARDS": "Queen of hearts" } },
  { id: 33, title: "Core Values", themes: ["FRUIT", "TECH", "PHYSICS", "MUSIC"], colors: ["#22C55E", "#3B82F6", "#8B5CF6", "#EC4899"], solution: { 0: "MACINTOSH", 1: "JOBS", 2: "AIR", 3: "GRAVITY", 4: "REVOLUTION", 5: "VINYL", 6: "JAM", 7: "CIDER" }, bridges: { "MACINTOSH": ["Apple variety", "Classic Mac computer"], "AIR": ["MacBook model", "Resistance medium"], "REVOLUTION": ["Orbital motion", "Famous song"], "JAM": ["Fruit preserve", "Musical session"] }, anchors: { "JOBS": "Co-founder Steve", "GRAVITY": "Newton's force", "VINYL": "Record format", "CIDER": "Fermented juice" }, centerWord: "APPLE", centerHints: ["Gala, e.g.", "Jobs creation", "Inspiration for Isaac Newton", "Orchard fruit"], centerExplanations: { "FRUIT": "An apple variety", "TECH": "Apple Inc.", "PHYSICS": "Newton's apple", "MUSIC": "Apple Records" } },
  { id: 34, title: "The Bottom Line", themes: ["TENNIS", "COMPUTERS", "FISHING", "FINANCE"], colors: ["#F59E0B", "#6366F1", "#3B82F6", "#10B981"], solution: { 0: "SERVER", 1: "MOUSE", 2: "STREAM", 3: "BAIT", 4: "BANK", 5: "YIELD", 6: "RETURN", 7: "RACKET" }, bridges: { "SERVER": ["Starts the point", "Network computer"], "STREAM": ["Data flow", "River current"], "BANK": ["River edge", "Financial institution"], "RETURN": ["Investment profit", "Hit ball back"] }, anchors: { "MOUSE": "Input device", "BAIT": "Lure for fish", "YIELD": "Investment return", "RACKET": "Tennis paddle" }, centerWord: "NET", centerHints: ["What a birdie flies over", "Catchy thing?", "After deductions", "Circus safety device"], centerExplanations: { "TENNIS": "The tennis net", "COMPUTERS": "The net", "FISHING": "A fishing net", "FINANCE": "Net income" } },
  { id: 35, title: "Seeing Red", themes: ["CANDY", "SPACE", "MYTH", "MUSIC"], colors: ["#92400E", "#1F2937", "#8B5CF6", "#EC4899"], solution: { 0: "MILKY WAY", 1: "ROVER", 2: "TITAN", 3: "ARES", 4: "MERCURY", 5: "FUNK", 6: "KISS", 7: "WRAPPER" }, bridges: { "MILKY WAY": ["Chocolate bar", "Our galaxy"], "TITAN": ["Saturn's moon", "Pre-Olympian god"], "MERCURY": ["Messenger god", "Freddie of Queen"], "KISS": ["Rock band", "Chocolate drop"] }, anchors: { "ROVER": "Planetary explorer", "ARES": "Greek war god", "FUNK": "Bruno's genre", "WRAPPER": "Candy packaging" }, centerWord: "MARS", centerHints: ["Curiosity's locale", "Land of Opportunity?", "Milky Way maker", "Fourth rock from the sun"], centerExplanations: { "CANDY": "Mars candy bar", "SPACE": "The planet Mars", "MYTH": "Mars, god of war", "MUSIC": "Bruno Mars" } },
  { id: 36, title: "Cold Front", themes: ["BEER", "WRITING", "MILITARY", "WIND"], colors: ["#F59E0B", "#6B7280", "#EF4444", "#3B82F6"], solution: { 0: "PROOF", 1: "EDIT", 2: "REVIEW", 3: "SERVICE", 4: "FORCE", 5: "GUST", 6: "COLD", 7: "PINT" }, bridges: { "PROOF": ["Alcohol percentage", "Galley copy"], "REVIEW": ["Critical appraisal", "Troop inspection"], "FORCE": ["Air Force", "Gale force"], "COLD": ["Chilly air", "Chilled drink"] }, anchors: { "EDIT": "Revision pass", "SERVICE": "Military duty", "GUST": "Wind burst", "PINT": "Beer measure" }, centerWord: "DRAFT", centerHints: ["Send to the front?", "Tap choice", "Early writing", "Alternative to a volunteer army"], centerExplanations: { "BEER": "Draft beer", "WRITING": "A rough draft", "MILITARY": "The military draft", "WIND": "A draft of cold air" } },
  { id: 37, title: "Gloves Off", themes: ["CONSERVATISM", "BOXING", "ETHICS", "LAW"], colors: ["#EF4444", "#F97316", "#10B981", "#1F2937"], solution: { 0: "STANCE", 1: "DECISION", 2: "CLEAN", 3: "CHARACTER", 4: "CODE", 5: "COUNSEL", 6: "PARTY", 7: "FACTION" }, bridges: { "STANCE": ["Ideological position", "Fighting posture"], "CLEAN": ["Fair and sportsmanlike", "Morally pure"], "CODE": ["Moral principles", "Legal statutes"], "PARTY": ["Litigant in lawsuit", "Political organization"] }, anchors: { "DECISION": "Fight goes the distance", "CHARACTER": "Moral fiber", "COUNSEL": "Legal representation", "FACTION": "Political subgroup" }, centerWord: "RIGHT", centerHints: ["The conservative faction", "The power punch for most", "Moral correctness", "Legal entitlement"], centerExplanations: { "CONSERVATISM": "The political right", "BOXING": "A right hook", "ETHICS": "Right and wrong", "LAW": "A legal right" } },
  { id: 38, title: "Rank and File", themes: ["SEQUENCE", "LEGAL", "ARCHITECTURE", "RELIGIOUS"], colors: ["#3B82F6", "#1F2937", "#78716C", "#8B5CF6"], solution: { 0: "DOCKET", 1: "GAG", 2: "COURT", 3: "CAPITAL", 4: "CLOISTER", 5: "HABIT", 6: "CHAPTER", 7: "SUCCESSION" }, bridges: { "DOCKET": ["Court calendar", "Agenda in sequence"], "COURT": ["Where judges preside", "Open courtyard"], "CLOISTER": ["Covered colonnade", "Monastic enclosure"], "CHAPTER": ["Division of religious order", "Book section"] }, anchors: { "GAG": "Silencing injunction", "CAPITAL": "Column crown", "HABIT": "Nun's garment", "SUCCESSION": "Line of inheritance" }, centerWord: "ORDER", centerHints: ["It's bigger than a family", "Alphabetize, e.g.", "Gavel pounder's demand", "Waiter's jotting"], centerExplanations: { "SEQUENCE": "In proper order", "LEGAL": "A court order", "ARCHITECTURE": "A classical order", "RELIGIOUS": "A religious order" } },
  { id: 39, title: "The Web We Weave", themes: ["TEXTILE", "NARRATIVE", "SOCIAL", "COMPUTING"], colors: ["#EC4899", "#F59E0B", "#3B82F6", "#10B981"], solution: { 0: "WEAVE", 1: "PLOT", 2: "POST", 3: "VIRAL", 4: "NETWORK", 5: "CRASH", 6: "LOOP", 7: "NEEDLE" }, bridges: { "WEAVE": ["Interlace fibers", "Weave a narrative"], "POST": ["Blog or article entry", "Share online"], "NETWORK": ["Online connections", "Connected computers"], "LOOP": ["Program iteration cycle", "Thread looped through fabric"] }, anchors: { "PLOT": "Story arc or scheme", "VIRAL": "Spreading rapidly", "CRASH": "System failure", "NEEDLE": "Sewing implement" }, centerWord: "THREAD", centerHints: ["Work one's way through, as a maze", "Sewer line?", "Series of online comments", "Filament"], centerExplanations: { "TEXTILE": "A thread of yarn", "NARRATIVE": "The thread of a story", "SOCIAL": "A Twitter/X thread", "COMPUTING": "A program thread" } },
  { id: 40, title: "Ready or Not", themes: ["THEATER", "TENNIS", "DINING", "GYM"], colors: ["#EC4899", "#22C55E", "#F97316", "#3B82F6"], solution: { 0: "BOX", 1: "MATCH", 2: "SERVE", 3: "TABLE", 4: "DIP", 5: "REP", 6: "ROUTINE", 7: "SCENE" }, bridges: { "BOX": ["Private seating area", "Target area for serve"], "SERVE": ["Start the point", "Deliver food"], "DIP": ["Appetizer sauce", "Tricep exercise"], "ROUTINE": ["Workout regimen", "Dance or comedy act"] }, anchors: { "MATCH": "Tennis competition", "TABLE": "Where diners sit", "REP": "Single repetition", "SCENE": "Dramatic segment" }, centerWord: "SET", centerHints: ["Something made just for show?", "Comic's batch of bits", "Wimbledon unit", "Sink, as the sun"], centerExplanations: { "THEATER": "A stage set", "TENNIS": "A tennis set", "DINING": "Set the table", "GYM": "Sets and reps" } },
  { id: 41, title: "Access Granted", themes: ["ARCHITECTURE", "BASKETBALL", "TOOLS", "LOCKS"], colors: ["#64748B", "#F97316", "#78716C", "#F59E0B"], solution: { 0: "POST", 1: "PAINT", 2: "DRILL", 3: "WRENCH", 4: "PICK", 5: "TUMBLER", 6: "VAULT", 7: "ARCH" }, bridges: { "POST": ["Vertical structural support", "Position near the basket"], "DRILL": ["Practice exercise", "Boring tool"], "PICK": ["Sharp hand tool", "Tool to open locks"], "VAULT": ["Secure room for valuables", "Arched ceiling structure"] }, anchors: { "ARCH": "Curved architectural span", "PAINT": "Area under the basket", "WRENCH": "Torque tool", "TUMBLER": "Lock cylinder component" }, centerWord: "KEY", centerHints: ["What makes a tumbler spin", "Speck in the ocean", "G, e.g., but not H", "Lock opener"], centerExplanations: { "ARCHITECTURE": "Keystone - Central stone of an arch", "BASKETBALL": "The Key - Painted area under hoop", "TOOLS": "Allen Key - Hexagonal wrench", "LOCKS": "Key - Mechanism opener" } }
];

let currentPuzzleIdx = 0;
let currentPuzzle = null;
let grid = {};
let selected = null;
let moves = 0;
let solved = false;
let solvedPuzzles = {};
let centerGuessed = false;
let revealedHints = [];
let guessAttempts = 0;
let maxAttempts = 4;

// Load solved puzzles from localStorage
function loadSolvedPuzzles() {
  PUZZLES.forEach(function(p, idx) {
    if (localStorage.getItem('associology-solved-' + idx)) {
      solvedPuzzles[p.id] = true;
    }
  });
}

// Save a puzzle as solved
function saveSolvedPuzzle(idx) {
  localStorage.setItem('associology-solved-' + idx, 'true');
}

// Count solved puzzles
function getSolvedCount() {
  return Object.keys(solvedPuzzles).length;
}

// Find the first unsolved puzzle index (returns 0 if all solved)
function getFirstUnsolvedIdx() {
  for (var i = 0; i < PUZZLES.length; i++) {
    if (!solvedPuzzles[PUZZLES[i].id]) {
      return i;
    }
  }
  return 0; // All solved, return to beginning
}

// Update progress indicator
function updateProgressIndicator() {
  var count = getSolvedCount();
  var total = PUZZLES.length;
  var indicator = document.getElementById('progress-indicator');
  indicator.textContent = count + '/' + total + ' solved';
  
  // Update Next Unsolved button state
  var btn = document.getElementById('next-unsolved-btn');
  var nextIdx = getFirstUnsolvedIdx();
  // Disable if all solved OR if current puzzle is the only unsolved one
  btn.disabled = (count === total);
}

// Navigate to next unsolved puzzle
function nextUnsolved() {
  var idx = getFirstUnsolvedIdx();
  loadPuzzle(idx);
}

// Load solved state on init
loadSolvedPuzzles();

const board = document.getElementById('board');
const slicesGroup = document.getElementById('slices');
const labelsGroup = document.getElementById('labels');

function openHelp() { document.getElementById('help-modal').classList.add('show'); }
function closeHelp() { document.getElementById('help-modal').classList.remove('show'); }
function openGallery() { renderGallery(); document.getElementById('gallery-modal').classList.add('show'); }
function closeGallery() { document.getElementById('gallery-modal').classList.remove('show'); }

// Cultural puzzles have proper nouns as center word or in clues
function isCultural(puzzleId) {
  return [23, 29, 30, 31, 32, 33, 35].indexOf(puzzleId) !== -1;
}

function toggleBadgeTooltip() {
  var tooltip = document.getElementById('badge-tooltip');
  var content = document.getElementById('badge-tooltip-content');
  
  if (tooltip.classList.contains('show')) {
    tooltip.classList.remove('show');
    return;
  }
  
  if (isCultural(currentPuzzle.id)) {
    content.innerHTML = '<strong>üåç Cultural Puzzle</strong><br>The mystery word and some clues may be famous names, brands, or places ‚Äî not just dictionary words.';
  } else {
    content.innerHTML = '<strong>üìñ Classic Puzzle</strong><br>All words in this puzzle are standard dictionary words.';
  }
  
  tooltip.classList.add('show');
  
  // Auto-hide after 4 seconds
  setTimeout(function() {
    tooltip.classList.remove('show');
  }, 4000);
}

// Hide badge tooltip when clicking elsewhere
document.addEventListener('click', function(e) {
  var tooltip = document.getElementById('badge-tooltip');
  var badge = document.getElementById('puzzle-type-badge');
  if (tooltip && badge && !tooltip.contains(e.target) && e.target !== badge) {
    tooltip.classList.remove('show');
  }
});

function renderGallery() {
  const g = document.getElementById('gallery-grid');
  g.innerHTML = '';
  PUZZLES.forEach((p, idx) => {
    const item = document.createElement('div');
    item.className = 'gallery-item';
    if (idx === currentPuzzleIdx) item.classList.add('current');
    if (solvedPuzzles[p.id]) item.classList.add('solved');
    var badge = isCultural(p.id) ? 'üåç' : 'üìñ';
    item.innerHTML = '<div class="gallery-badge">' + badge + '</div><div class="gallery-title">#' + p.id + ' ' + (p.title || '') + '</div>' + (solvedPuzzles[p.id] ? '<div class="solved-check">‚úì</div>' : '');
    item.onclick = function() { loadPuzzle(idx); closeGallery(); };
    g.appendChild(item);
  });
}

function loadPuzzle(idx) {
  currentPuzzleIdx = idx;
  currentPuzzle = PUZZLES[idx];
  document.getElementById('puzzle-title').textContent = '#' + currentPuzzle.id + ' ' + (currentPuzzle.title || '');
  document.getElementById('current-num').textContent = idx + 1;
  document.getElementById('total-num').textContent = PUZZLES.length;
  document.getElementById('prev-btn').disabled = idx === 0;
  document.getElementById('next-btn').disabled = idx === PUZZLES.length - 1;
  
  // Update progress indicator
  updateProgressIndicator();
  
  // Set puzzle type badge
  var badge = document.getElementById('puzzle-type-badge');
  badge.textContent = isCultural(currentPuzzle.id) ? 'üåç' : 'üìñ';
  
  // Hide badge tooltip if open
  document.getElementById('badge-tooltip').classList.remove('show');
  
  // Reset guessing state
  revealedHints = [];
  guessAttempts = 0;
  centerGuessed = false;
  
  // Hide hints panel
  document.getElementById('hints-panel').classList.remove('show');
  
  // Reset center circle if in guessing mode
  var circle = document.getElementById('center-circle');
  circle.classList.remove('guessing-mode', 'guessed', 'show');
  circle.onclick = function() { openGuessModal(); };
  
  // Show game buttons
  document.getElementById('game-buttons').style.display = '';
  
  // Hide center panel and solved banner
  document.getElementById('center-panel').classList.remove('show');
  document.getElementById('solved-banner').classList.remove('show');
  
  initBoard();
  shuffle();
}

function prevPuzzle() { if (currentPuzzleIdx > 0) loadPuzzle(currentPuzzleIdx - 1); }
function nextPuzzle() { if (currentPuzzleIdx < PUZZLES.length - 1) loadPuzzle(currentPuzzleIdx + 1); }

function getBoardSize() { return board.getBoundingClientRect().width; }

function polarToXY(angleDeg, radiusFrac, size) {
  var rad = (angleDeg - 90) * Math.PI / 180;
  var r = (size / 2) * radiusFrac;
  return { x: size/2 + r * Math.cos(rad), y: size/2 + r * Math.sin(rad) };
}

function drawSlice(startAngle, endAngle, color) {
  var cx = 250, cy = 250, r = 240;
  var start = (startAngle - 90) * Math.PI / 180;
  var end = (endAngle - 90) * Math.PI / 180;
  var x1 = cx + r * Math.cos(start), y1 = cy + r * Math.sin(start);
  var x2 = cx + r * Math.cos(end), y2 = cy + r * Math.sin(end);
  var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("d", "M " + cx + " " + cy + " L " + x1 + " " + y1 + " A " + r + " " + r + " 0 0 1 " + x2 + " " + y2 + " Z");
  path.setAttribute("fill", color);
  path.setAttribute("class", "slice");
  return path;
}

function drawLabel(angle, text, id) {
  var cx = 250, cy = 250, r = 218;
  var startAngle = angle - 30, endAngle = angle + 30;
  var isBottom = angle > 90 && angle < 270;
  if (isBottom) { var temp = startAngle; startAngle = endAngle; endAngle = temp; }
  var startRad = (startAngle - 90) * Math.PI / 180;
  var endRad = (endAngle - 90) * Math.PI / 180;
  var x1 = cx + r * Math.cos(startRad), y1 = cy + r * Math.sin(startRad);
  var x2 = cx + r * Math.cos(endRad), y2 = cy + r * Math.sin(endRad);
  var pathId = "arc-" + id;
  var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
  path.setAttribute("id", pathId);
  path.setAttribute("d", "M " + x1 + " " + y1 + " A " + r + " " + r + " 0 0 " + (isBottom ? 0 : 1) + " " + x2 + " " + y2);
  path.setAttribute("fill", "none");
  var textEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
  textEl.setAttribute("class", "theme-label");
  var textPath = document.createElementNS("http://www.w3.org/2000/svg", "textPath");
  textPath.setAttribute("href", "#" + pathId);
  textPath.setAttribute("startOffset", "50%");
  textPath.setAttribute("text-anchor", "middle");
  textPath.textContent = text;
  textEl.appendChild(textPath);
  return { path: path, text: textEl };
}

function initBoard() {
  var drops = document.querySelectorAll('.drop');
  for (var i = 0; i < drops.length; i++) drops[i].remove();
  slicesGroup.innerHTML = '';
  var angles = [270, 0, 90, 180];
  for (var i = 0; i < angles.length; i++) {
    slicesGroup.appendChild(drawSlice(angles[i], angles[i] + 90, currentPuzzle.colors[i]));
  }
  
  labelsGroup.innerHTML = '';
  var defs = document.querySelector('#svg defs');
  if (!defs) { 
    defs = document.createElementNS("http://www.w3.org/2000/svg", "defs"); 
    document.getElementById('svg').insertBefore(defs, slicesGroup); 
  }
  defs.innerHTML = '';
  
  var labelAngles = [315, 45, 135, 225];
  for (var i = 0; i < labelAngles.length; i++) {
    var result = drawLabel(labelAngles[i], currentPuzzle.themes[i], "theme-" + i);
    defs.appendChild(result.path);
    labelsGroup.appendChild(result.text);
  }
  
  var positions = {
    0: { type: "bridge", angle: 0, radius: 0.65 },
    1: { type: "anchor", angle: 45, radius: 0.58 },
    2: { type: "bridge", angle: 90, radius: 0.65 },
    3: { type: "anchor", angle: 135, radius: 0.58 },
    4: { type: "bridge", angle: 180, radius: 0.65 },
    5: { type: "anchor", angle: 225, radius: 0.58 },
    6: { type: "bridge", angle: 270, radius: 0.65 },
    7: { type: "anchor", angle: 315, radius: 0.58 }
  };
  
  for (var pos = 0; pos < 8; pos++) {
    var cfg = positions[pos];
    var drop = document.createElement('div');
    drop.id = "drop-" + pos;
    drop.className = "drop " + cfg.type;
    drop.dataset.pos = pos;
    drop.dataset.angle = cfg.angle;
    drop.dataset.radius = cfg.radius;
    (function(p) {
      drop.onclick = function() { handleDropClick(p); };
    })(pos);
    board.appendChild(drop);
  }
  positionDropZones();
  window.addEventListener('resize', positionDropZones);
}

function positionDropZones() {
  var size = getBoardSize();
  for (var pos = 0; pos < 8; pos++) {
    var drop = document.getElementById("drop-" + pos);
    if (!drop) continue;
    var angle = parseFloat(drop.dataset.angle);
    var radius = parseFloat(drop.dataset.radius);
    var coords = polarToXY(angle, radius, size);
    drop.style.left = coords.x + 'px';
    drop.style.top = coords.y + 'px';
    if (drop.classList.contains('bridge')) {
      drop.style.transform = "translate(-50%, -50%) rotate(" + angle + "deg)";
    }
  }
}

function shuffle() {
  solved = false;
  moves = 0;
  selected = null;
  centerGuessed = false;
  guessAttempts = 0;
  revealedHints = [];
  updateMoveCount();
  document.getElementById('solved-banner').classList.remove('show');
  hideBridgeTooltip();
  document.getElementById('center-circle').classList.remove('show', 'guessed');
  var letterCount = currentPuzzle.centerWord.length;
  document.getElementById('center-circle').innerHTML = '<span class="letter-count">' + letterCount + '</span><span class="letter-label">letters</span>';
  document.getElementById('center-panel').classList.remove('show');
  document.getElementById('game-buttons').style.display = 'flex';
  hideExplanations();
  
  var anchorPos = [1, 3, 5, 7], bridgePos = [0, 2, 4, 6];
  var anchorWords = anchorPos.map(function(p) { return currentPuzzle.solution[p]; });
  var bridgeWords = bridgePos.map(function(p) { return currentPuzzle.solution[p]; });
  var anchorD = getDerangement(4), bridgeD = getDerangement(4);
  for (var i = 0; i < anchorPos.length; i++) grid[anchorPos[i]] = anchorWords[anchorD[i]];
  for (var i = 0; i < bridgePos.length; i++) grid[bridgePos[i]] = bridgeWords[bridgeD[i]];
  renderGrid();
  checkGroups();
}

function getDerangement(n) {
  var arr;
  do {
    arr = [];
    for (var i = 0; i < n; i++) arr.push(i);
    for (var i = arr.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = arr[i]; arr[i] = arr[j]; arr[j] = temp;
    }
  } while (arr.some(function(v, i) { return v === i; }));
  return arr;
}

function renderGrid() {
  for (var pos = 0; pos < 8; pos++) {
    var drop = document.getElementById("drop-" + pos);
    if (!drop) continue;
    var word = grid[pos];
    var existing = drop.querySelector('.token');
    if (existing) existing.remove();
    if (word) {
      var token = document.createElement('div');
      token.className = 'token';
      token.textContent = word;
      token.dataset.pos = pos;
      var angle = parseFloat(drop.dataset.angle);
      if (drop.classList.contains('bridge')) {
        token.style.transform = "rotate(" + (-angle) + "deg)";
      }
      drop.appendChild(token);
    }
    drop.classList.remove('selected', 'correct');
    var t = drop.querySelector('.token');
    if (t) t.classList.remove('selected', 'correct');
  }
}

function handleDropClick(pos, event) {
  var drop = document.getElementById("drop-" + pos);
  var token = drop.querySelector('.token');
  
  // If solved, show tooltip for all words
  if (solved) {
    var bridgePositions = [0, 2, 4, 6];
    var anchorPositions = [1, 3, 5, 7];
    if (token) {
      var word = token.textContent;
      var rect = token.getBoundingClientRect();
      var x = rect.left + rect.width / 2;
      var y = rect.bottom;
      if (bridgePositions.indexOf(pos) !== -1) {
        showBridgeTooltip(word, x, y, true);
      } else if (anchorPositions.indexOf(pos) !== -1) {
        showBridgeTooltip(word, x, y, false);
      }
    }
    return;
  }
  
  if (selected === null) {
    selected = pos;
    drop.classList.add('selected');
    if (token) token.classList.add('selected');
  } else if (selected === pos) {
    selected = null;
    drop.classList.remove('selected');
    if (token) token.classList.remove('selected');
  } else {
    var temp = grid[selected];
    grid[selected] = grid[pos];
    grid[pos] = temp;
    selected = null;
    moves++;
    updateMoveCount();
    renderGrid();
    checkGroups();
  }
}

function updateMoveCount() { document.getElementById('move-count').textContent = moves; }

function checkGroups() {
  var themePos = [[7, 0, 6], [0, 1, 2], [2, 3, 4], [4, 5, 6]];
  var allCorrect = true;
  
  var themeCorrect = [];
  for (var idx = 0; idx < themePos.length; idx++) {
    var positions = themePos[idx];
    var isCorrect = positions.every(function(p) { return grid[p] === currentPuzzle.solution[p]; });
    var slices = slicesGroup.querySelectorAll('.slice');
    if (slices[idx]) {
      if (isCorrect) slices[idx].classList.add('correct');
      else slices[idx].classList.remove('correct');
    }
    if (!isCorrect) allCorrect = false;
    themeCorrect.push(isCorrect);
  }
  
  var bridgeConfig = {
    0: { themes: [0, 1], gradientAngle: 90 },
    2: { themes: [1, 2], gradientAngle: 180 },
    4: { themes: [3, 2], gradientAngle: 90 },
    6: { themes: [0, 3], gradientAngle: 180 }
  };
  
  for (var pos = 0; pos < 8; pos++) {
    var drop = document.getElementById("drop-" + pos);
    var token = drop ? drop.querySelector('.token') : null;
    if (!token) continue;
    
    token.classList.remove('correct');
    token.style.background = '';
    token.style.color = '';
    token.style.borderColor = '';
    if (drop) drop.classList.remove('correct');
    
    if (drop.classList.contains('bridge')) {
      var config = bridgeConfig[pos];
      var aCorrect = themeCorrect[config.themes[0]];
      var bCorrect = themeCorrect[config.themes[1]];
      
      if (aCorrect && bCorrect) {
        token.classList.add('correct');
        if (drop) drop.classList.add('correct');
      } else if (aCorrect || bCorrect) {
        var colorA = aCorrect ? '#22c55e' : 'white';
        var colorB = bCorrect ? '#22c55e' : 'white';
        token.style.background = "linear-gradient(" + config.gradientAngle + "deg, " + colorA + " 50%, " + colorB + " 50%)";
        token.style.borderColor = '#1a1a2e';
      }
    } else {
      var isInCorrectTheme = false;
      for (var idx = 0; idx < themePos.length; idx++) {
        if (themePos[idx].indexOf(pos) !== -1 && themeCorrect[idx]) {
          isInCorrectTheme = true;
          break;
        }
      }
      if (isInCorrectTheme) {
        token.classList.add('correct');
        if (drop) drop.classList.add('correct');
      }
    }
  }
  
  if (allCorrect && !solved) {
    solved = true;
    solvedPuzzles[currentPuzzle.id] = true;
    saveSolvedPuzzle(currentPuzzleIdx);
    updateProgressIndicator();
    document.getElementById('solved-banner').innerHTML = 'üéâ Stage 1 complete in <span id="final-moves">' + moves + '</span> moves! <strong>Tap the center</strong> to guess the word...';
    document.getElementById('solved-banner').classList.add('show');
    document.getElementById('game-buttons').style.display = 'none';
    showExplanations();
  }
}

function showExplanations() {
  document.getElementById('explanations').classList.add('show');
  
  if (!centerGuessed) {
    var circle = document.getElementById('center-circle');
    var len = currentPuzzle.centerWord.length;
    circle.textContent = len + ' letters';
    circle.classList.add('show');
  }
}

function hideExplanations() { 
  document.getElementById('explanations').classList.remove('show'); 
}

function showBridgeTooltip(word, x, y, isBridge) {
  var tooltip = document.getElementById('bridge-tooltip');
  document.getElementById('tooltip-word').textContent = word;
  
  if (isBridge) {
    var meanings = currentPuzzle.bridges[word];
    if (!meanings) return;
    document.getElementById('tooltip-meanings').innerHTML = '<span>' + meanings[0] + '</span> / <span>' + meanings[1] + '</span>';
  } else {
    var meaning = currentPuzzle.anchors ? currentPuzzle.anchors[word] : null;
    if (!meaning) return;
    document.getElementById('tooltip-meanings').innerHTML = '<span>' + meaning + '</span>';
  }
  
  // Position tooltip
  var tooltipWidth = 280;
  var tooltipHeight = 80;
  var left = Math.max(10, Math.min(x - tooltipWidth/2, window.innerWidth - tooltipWidth - 10));
  var top = y + 20;
  
  // If tooltip would go off bottom, show above instead
  if (top + tooltipHeight > window.innerHeight) {
    top = y - tooltipHeight - 20;
  }
  
  tooltip.style.left = left + 'px';
  tooltip.style.top = top + 'px';
  tooltip.classList.add('show');
}

function hideBridgeTooltip() {
  document.getElementById('bridge-tooltip').classList.remove('show');
}

// Close tooltip when clicking elsewhere
document.addEventListener('click', function(e) {
  if (!e.target.closest('.token') && !e.target.closest('.bridge-tooltip')) {
    hideBridgeTooltip();
  }
});

function openGuessModal() {
  // If center already guessed, show the center panel with meanings
  if (centerGuessed) {
    document.getElementById('center-panel').classList.add('show');
    return;
  }
  
  if (!solved) return;
  
  // Enter guessing mode - expand center circle with input
  enterGuessingMode();
}

function enterGuessingMode() {
  var circle = document.getElementById('center-circle');
  var letterCount = currentPuzzle.centerWord.length;
  
  // Add guessing mode class
  circle.classList.add('guessing-mode');
  circle.onclick = null; // Disable click while in guessing mode
  
  // Create input wrapper
  circle.innerHTML = '<div class="center-input-wrapper">' +
    '<div class="center-letter-count">' + letterCount + ' letters</div>' +
    '<input type="text" class="center-input" id="center-guess-input" maxlength="' + (letterCount + 2) + '" autocomplete="off" autocapitalize="characters" autocorrect="off" spellcheck="false" inputmode="text" placeholder="?">' +
    '<button class="center-submit" onclick="submitCenterGuess()">Submit</button>' +
    '<div class="center-wrong-guesses" id="center-wrong-guesses"></div>' +
    '</div>';
  
  // Focus the input - do it immediately since this is triggered by user tap
  var input = document.getElementById('center-guess-input');
  if (input) {
    input.focus();
    // Backup focus attempt for iOS
    setTimeout(function() {
      if (document.activeElement !== input) {
        input.focus();
      }
    }, 50);
  }
  
  // Setup keyboard handler
  document.getElementById('center-guess-input').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      submitCenterGuess();
    }
  });
  
  // Show hints panel below puzzle
  showHintsPanel();
  
  // Hide game buttons, keep explanations visible for word tapping
  document.getElementById('game-buttons').style.display = 'none';
}

function showHintsPanel() {
  var panel = document.getElementById('hints-panel');
  var progressDiv = document.getElementById('hints-progress');
  var hintsContainer = document.getElementById('hints-container');
  var hintBtn = document.getElementById('panel-hint-btn');
  
  // Clear previous content
  progressDiv.innerHTML = '';
  hintsContainer.innerHTML = '';
  
  // Add progress dots
  for (var d = 0; d < 4; d++) {
    var dot = document.createElement('div');
    dot.className = 'hint-dot';
    if (d < revealedHints.length) {
      dot.classList.add('revealed');
    } else if (d === revealedHints.length) {
      dot.classList.add('current');
    }
    progressDiv.appendChild(dot);
  }
  
  // Add crossword hints (hidden until revealed)
  for (var i = 0; i < currentPuzzle.centerHints.length; i++) {
    var hintDiv = document.createElement('div');
    hintDiv.className = 'crossword-hint';
    hintDiv.dataset.index = i;
    
    if (i < revealedHints.length) {
      hintDiv.classList.add('revealed');
    }
    
    hintDiv.innerHTML = '<span class="hint-number">' + (i + 1) + '.</span> ' + currentPuzzle.centerHints[i];
    hintsContainer.appendChild(hintDiv);
  }
  
  // Setup hint button
  if (revealedHints.length >= 4) {
    hintBtn.textContent = 'All hints revealed';
    hintBtn.disabled = true;
    hintBtn.onclick = null;
  } else {
    hintBtn.textContent = 'Get Hint (' + (4 - revealedHints.length) + ' remaining)';
    hintBtn.disabled = false;
    hintBtn.onclick = revealNextHintInPanel;
  }
  
  panel.classList.add('show');
}

function revealNextHintInPanel() {
  var currentCount = revealedHints.length;
  if (currentCount >= 4) return;
  
  // Reveal next hint
  revealedHints.push(currentCount);
  
  // Update hint display
  var hints = document.querySelectorAll('#hints-container .crossword-hint');
  if (hints[currentCount]) {
    hints[currentCount].classList.add('revealed');
  }
  
  // Update progress dots
  var dots = document.querySelectorAll('#hints-progress .hint-dot');
  if (dots[currentCount]) {
    dots[currentCount].classList.remove('current');
    dots[currentCount].classList.add('revealed');
  }
  if (dots[currentCount + 1]) {
    dots[currentCount + 1].classList.add('current');
  }
  
  // Update button
  var btn = document.getElementById('panel-hint-btn');
  if (revealedHints.length >= 4) {
    btn.textContent = 'All hints revealed';
    btn.disabled = true;
    btn.onclick = null;
  } else {
    btn.textContent = 'Get Hint (' + (4 - revealedHints.length) + ' remaining)';
  }
}

function submitCenterGuess() {
  var input = document.getElementById('center-guess-input');
  var guess = input.value.trim().toUpperCase();
  var answer = currentPuzzle.centerWord;
  
  // Validate - must have content
  if (!guess) {
    input.classList.add('shake');
    setTimeout(function() { input.classList.remove('shake'); }, 400);
    return;
  }
  
  guessAttempts++;
  
  // Check if correct
  if (guess === answer) {
    centerGuessed = true;
    showGuessingSuccess();
    return;
  }
  
  // Wrong guess - add to display
  var wrongDiv = document.getElementById('center-wrong-guesses');
  var wrongSpan = document.createElement('span');
  wrongSpan.className = 'center-wrong-guess';
  wrongSpan.textContent = guess;
  wrongDiv.appendChild(wrongSpan);
  
  // Clear input for next guess
  input.value = '';
  input.classList.add('shake');
  setTimeout(function() { input.classList.remove('shake'); }, 400);
  
  // Check if out of attempts (4 max)
  if (guessAttempts >= maxAttempts) {
    showGuessingFailure();
    return;
  }
}

function showGuessingSuccess() {
  exitGuessingMode();
  
  var circle = document.getElementById('center-circle');
  circle.textContent = currentPuzzle.centerWord;
  circle.classList.add('guessed', 'celebrate');
  setTimeout(function() { circle.classList.remove('celebrate'); }, 500);
  
  var hintsUsed = revealedHints.length;
  var msg = 'üéâ Complete! Solved in <span id="final-moves">' + moves + '</span> moves + found <strong>' + currentPuzzle.centerWord + '</strong> in ' + guessAttempts + ' guess' + (guessAttempts > 1 ? 'es' : '');
  if (hintsUsed > 0) {
    msg += ' with ' + hintsUsed + ' hint' + (hintsUsed > 1 ? 's' : '');
  }
  msg += '!';
  document.getElementById('solved-banner').innerHTML = msg;
  
  showCenterPanel(guessAttempts);
}

function showGuessingFailure() {
  exitGuessingMode();
  
  centerGuessed = true;
  var circle = document.getElementById('center-circle');
  circle.textContent = currentPuzzle.centerWord;
  circle.classList.add('guessed');
  
  document.getElementById('solved-banner').innerHTML = 'üéâ Stage 1 complete! Center word: <strong>' + currentPuzzle.centerWord + '</strong>';
  
  showCenterPanelFailure();
}

function revealAnswer() {
  exitGuessingMode();
  
  centerGuessed = true;
  var circle = document.getElementById('center-circle');
  circle.textContent = currentPuzzle.centerWord;
  circle.classList.add('guessed');
  
  document.getElementById('solved-banner').innerHTML = 'üéâ Stage 1 complete! Center word: <strong>' + currentPuzzle.centerWord + '</strong>';
  
  showCenterPanelRevealed();
}

function exitGuessingMode() {
  var circle = document.getElementById('center-circle');
  circle.classList.remove('guessing-mode');
  circle.onclick = function() { openGuessModal(); };
  
  // Hide hints panel
  document.getElementById('hints-panel').classList.remove('show');
  
  // Show game buttons again (or hide if solved)
  document.getElementById('game-buttons').style.display = '';
}

function revealThemeHint(el, theme, meaning, idx) {
  if (el.classList.contains('revealed')) return;
  
  revealedHints.push(theme);
  el.classList.add('revealed');
  el.innerHTML = '<span class="theme-hint-label" style="color:' + currentPuzzle.colors[idx] + '">' + theme + ':</span><span class="theme-hint-text">"' + meaning + '"</span>';
  el.onclick = null;
}

// Calculate puzzle score
function calculateScore(moveCount, hintCount, gaveUp) {
  var score = 1000;
  
  // Ring stage scoring (moves)
  if (moveCount <= 4) {
    score += 100; // Perfect
  } else if (moveCount <= 6) {
    // Excellent - no modifier
  } else if (moveCount <= 10) {
    score -= 50; // Good
  } else {
    score -= 100; // Struggled
  }
  
  // Center word scoring (hints)
  if (hintCount === 0) {
    score += 200; // No hints - saw it cold
  } else if (hintCount === 1) {
    score += 100; // Light help
  } else if (hintCount === 2) {
    // Moderate - no modifier
  } else if (hintCount === 3) {
    score -= 100; // Heavy
  } else if (hintCount >= 4) {
    score -= 200; // All hints
  }
  
  // Gave up penalty
  if (gaveUp) {
    score -= 300;
  }
  
  return score;
}

// Get score label and class
function getScoreLabel(score) {
  if (score >= 1200) {
    return { text: '‚ö° Brilliant', className: 'brilliant' };
  } else if (score >= 1050) {
    return { text: 'üéØ Sharp', className: 'sharp' };
  } else if (score >= 900) {
    return { text: '‚úì Solid', className: 'solid' };
  } else if (score >= 700) {
    return { text: 'üîß Grinder', className: 'grinder' };
  } else {
    return { text: 'üëÄ Revealed', className: 'revealed' };
  }
}

// Create score display HTML
function createScoreDisplay(moveCount, hintCount, gaveUp) {
  var score = calculateScore(moveCount, hintCount, gaveUp);
  var label = getScoreLabel(score);
  
  var div = document.createElement('div');
  div.className = 'score-display';
  div.innerHTML = '<div class="score-number">' + score + '</div>' +
    '<div class="score-label ' + label.className + '">' + label.text + '</div>' +
    '<div class="score-breakdown">' + moveCount + ' moves ‚Ä¢ ' + hintCount + ' hint' + (hintCount !== 1 ? 's' : '') + (gaveUp ? ' ‚Ä¢ gave up' : '') + '</div>';
  
  return div;
}

function showCenterPanelRevealed() {
  document.getElementById('center-word-display').textContent = currentPuzzle.centerWord;
  var panelList = document.getElementById('center-panel-list');
  panelList.innerHTML = '';
  
  // Add score display (gave up = true)
  var scoreDisplay = createScoreDisplay(moves, revealedHints.length, true);
  panelList.appendChild(scoreDisplay);
  
  for (var theme in currentPuzzle.centerExplanations) {
    var meaning = currentPuzzle.centerExplanations[theme];
    var item = document.createElement('div');
    item.className = 'center-panel-item';
    item.innerHTML = '<span class="center-panel-theme">' + theme + '</span><span class="center-panel-meaning">' + meaning + '</span>';
    panelList.appendChild(item);
  }
  document.getElementById('center-panel').classList.add('show');
}

function showCenterPanel(guessCount) {
  document.getElementById('center-word-display').textContent = currentPuzzle.centerWord;
  var panelList = document.getElementById('center-panel-list');
  panelList.innerHTML = '';
  
  // Add score display (got it = not gave up)
  var scoreDisplay = createScoreDisplay(moves, revealedHints.length, false);
  panelList.appendChild(scoreDisplay);
  
  for (var theme in currentPuzzle.centerExplanations) {
    var meaning = currentPuzzle.centerExplanations[theme];
    var item = document.createElement('div');
    item.className = 'center-panel-item';
    item.innerHTML = '<span class="center-panel-theme">' + theme + '</span><span class="center-panel-meaning">' + meaning + '</span>';
    panelList.appendChild(item);
  }
  document.getElementById('center-panel').classList.add('show');
}

function showCenterPanelFailure() {
  document.getElementById('center-word-display').textContent = currentPuzzle.centerWord;
  var panelList = document.getElementById('center-panel-list');
  panelList.innerHTML = '';
  
  // Add score display (gave up after 4 wrong guesses)
  var scoreDisplay = createScoreDisplay(moves, revealedHints.length, true);
  panelList.appendChild(scoreDisplay);
  
  for (var theme in currentPuzzle.centerExplanations) {
    var meaning = currentPuzzle.centerExplanations[theme];
    var item = document.createElement('div');
    item.className = 'center-panel-item';
    item.innerHTML = '<span class="center-panel-theme">' + theme + '</span><span class="center-panel-meaning">' + meaning + '</span>';
    panelList.appendChild(item);
  }
  document.getElementById('center-panel').classList.add('show');
}

function solve() {
  for (var pos = 0; pos < 8; pos++) grid[pos] = currentPuzzle.solution[pos];
  renderGrid();
  checkGroups();
}

function startPlaying() {
  // Check if user wants to skip welcome in future
  if (document.getElementById('skip-welcome-checkbox').checked) {
    localStorage.setItem('associology-skip-welcome', 'true');
  }
  document.getElementById('welcome-overlay').classList.add('hidden');
}

// Initialize welcome board ring
function initWelcomeBoard() {
  var puzzle = PUZZLES[0]; // Use Puzzle 1
  var welcomeSlices = document.getElementById('welcome-slices');
  var welcomeLabels = document.getElementById('welcome-labels');
  var welcomeDefs = document.getElementById('welcome-defs');
  var welcomeBoard = document.getElementById('welcome-board');
  
  // Draw slices using same function as game
  var sliceAngles = [270, 0, 90, 180];
  for (var i = 0; i < sliceAngles.length; i++) {
    welcomeSlices.appendChild(drawSlice(sliceAngles[i], sliceAngles[i] + 90, puzzle.colors[i]));
  }
  
  // Draw labels using same function as game
  var labelAngles = [315, 45, 135, 225];
  for (var i = 0; i < labelAngles.length; i++) {
    var result = drawLabel(labelAngles[i], puzzle.themes[i], "welcome-theme-" + i);
    welcomeDefs.appendChild(result.path);
    welcomeLabels.appendChild(result.text);
  }
  
  // Add word chips - same positions as game
  var positions = {
    0: { angle: 0, radius: 0.65 },
    1: { angle: 45, radius: 0.58 },
    2: { angle: 90, radius: 0.65 },
    3: { angle: 135, radius: 0.58 },
    4: { angle: 180, radius: 0.65 },
    5: { angle: 225, radius: 0.58 },
    6: { angle: 270, radius: 0.65 },
    7: { angle: 315, radius: 0.58 }
  };
  
  function polarToPercent(angleDeg, radiusFrac) {
    var rad = (angleDeg - 90) * Math.PI / 180;
    var x = 50 + 50 * radiusFrac * Math.cos(rad);
    var y = 50 + 50 * radiusFrac * Math.sin(rad);
    return { x: x, y: y };
  }
  
  // Shuffle words for welcome screen
  var words = [];
  for (var i = 0; i < 8; i++) {
    words.push(puzzle.solution[i]);
  }
  // Fisher-Yates shuffle
  for (var i = words.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var temp = words[i];
    words[i] = words[j];
    words[j] = temp;
  }
  
  for (var pos = 0; pos < 8; pos++) {
    var cfg = positions[pos];
    var coords = polarToPercent(cfg.angle, cfg.radius);
    var drop = document.createElement('div');
    drop.className = 'welcome-drop';
    drop.style.left = coords.x + '%';
    drop.style.top = coords.y + '%';
    drop.textContent = words[pos];
    welcomeBoard.appendChild(drop);
  }
}

// Clear old localStorage key if present
localStorage.removeItem('associology-welcomed');

// Check if user opted to skip welcome screen
var isReturningPlayer = localStorage.getItem('associology-skip-welcome');
if (isReturningPlayer) {
  document.getElementById('welcome-overlay').classList.add('hidden');
}

// Initialize welcome board
initWelcomeBoard();

// Update puzzle count on welcome screen
document.querySelector('.welcome-footer span:last-child').textContent = PUZZLES.length + ' puzzles';

// For returning players, start at first unsolved puzzle
// For new players, start at puzzle 1
var startIdx = isReturningPlayer ? getFirstUnsolvedIdx() : 0;
loadPuzzle(startIdx);
</script>
</body>
</html>
